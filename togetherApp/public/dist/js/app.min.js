/**
 * Created by Marthe on 10/12/15.
 */

(function(){
    var app = angular.module("app", ["ngRoute"]);
    app.config(function($routeProvider){
        $routeProvider
            .when("/",{
                templateUrl: "./views/home.html"
            })
            .when("/signup",{
                templateUrl: "views/signup.html"
            })
            .when("/home",{
                templateUrl: "./views/home.html"
            })
            .when("/matches",{
                templateUrl: "./views/matches.html"
            })
            .when("/howto",{
                templateUrl: "./views/howTo.html"
            })
            .when("/activities",{
                templateUrl: "./views/activities.html"
            })
            .when("/admin",{
                templateUrl: "./views/admin.html"
            })
            .when("/searchprofiles",{
                templateUrl: "./views/searchProfiles.html"
            })
            .when("/myprofile",{
                templateUrl: "./views/myProfile.html"
            })
            .when("/userdetails/:username",{
                templateUrl: "./views/detailsUser.html",
                controller: 'UsersController'
            })
            .when("/detailsuser",{
                templateUrl: "./views/detailsUser.html"
            })
            .when("/activitydetails/:activityName", {
                templateUrl: "./views/detailsActivity.html",
                controller: "ActivitiesController"

            });


    });

    app.run(function ($rootScope) {
        $rootScope.user = {};
    });

    app.directive('ngEnter', function () {
        return function (scope, element, attrs) {
            element.bind("keydown keypress", function (event) {
                if (event.which === 13) {
                    scope.$apply(function () {
                        scope.$eval(attrs.ngEnter);
                    });

                    event.preventDefault();
                }
            });
        };
    });


    app.directive('fileModel', ['$parse', function ($parse) {
        return {
            restrict: 'A',
            link: function(scope, element, attrs) {
                var model = $parse(attrs.fileModel);
                var modelSetter = model.assign;

                element.bind('change', function(){
                    scope.$apply(function(){
                        modelSetter(scope, element[0].files[0]);
                    });
                });
            }
        };
    }]);

    app.service('fileUpload', ['$http', function ($http) {
        this.uploadFileToUrl = function(file, uploadUrl){
            var fd = new FormData();
            fd.append('file', file);
            $http.post(uploadUrl, fd, {
                transformRequest: angular.identity,
                headers: {'Content-Type': undefined}
            })
                .success(function(){
                    console.log("success");
                })
                .error(function(){
                    console.log("error");
                });
        };
    }]);


    app.directive('editableCheckbox', function () {
        return {
            restrict: 'E',
            templateUrl: './views/editablecheckbox.html'
        };
    });


})();
/**
 * Created by iman on 15/12/15.
 */
var Activity = function(img, name, place, keywords, participants, myEvent){
    this.img = img;
    this.name = name;
    this.place = place;
    this.keywords = keywords;
    this.participants = participants;
    this.myEvent = myEvent;
};
/**
 * Created by iman on 5/12/15.
 */
/*(function(){

    "use strict";

    var activitiesService = function () {

        var getActivities = function () {

            var localUrl = "http://localhost:3000/data/activities.json";
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", localUrl, false);
            xmlHttp.send(null);

            if(xmlHttp.status == 200) {

                var data = JSON.parse(xmlHttp.responseText);

                //console.log(data);

                var arrActivities = [];

                for (var i = 0; i < data.length; i++) {

                    var d = data[i];

                    var newActivity = new Activity();
                    newActivity.img = d.img;
                    newActivity.name = d.name;
                    newActivity.place = d.place;
                    newActivity.participants = d.participants;
                    newActivity.myEvent = d.myEvent;

                    var text = "";

                    for(var ii=0; ii< d.keywords.length; ii++){
                        if(ii == d.keywords.length-1){
                            text += d.keywords[ii];
                        }
                        else{
                            text += d.keywords[ii];
                            text += ", ";
                        }
                    }

                    newActivity.keywords = text;
                    arrActivities.push(newActivity);
                }

                return arrActivities;

            }

        };

        //public gedeelte
        return{

            getActivities:getActivities

        };

    };

    angular.module("app").factory("activitiesService", [activitiesService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();*/
/**
 * Created by iman on 15/12/15.
 */

(function(){

    "use strict";

    var dbService = function ($http) {

        var getCollection = function (collection) {


            var url = "http://localhost:3000/api/" + collection;
            return $http.get(url).then(function(response){
                return response.data;

            });

        };

        var getByID = function (collection, id) {
            var url = "http://localhost:3000/api/" + collection + "/" + id;
            return $http.get(url).then(function(response){
                return response.data;

            });

        };

        var getDetailsUser = function (collection, username) {
            var url = "http://localhost:3000/api/" + collection + "/userdetail/" + username;
            return $http.get(url).then(function(response){
                return response.data;

            });

        };

        var getItem = function(item){

            var url = "http://localhost:3000/api/" + item;
            return $http.get('/user').then(function(response){

                return response.data;

            });

        };

        var getDetailsActivity = function (collection, activityname) {
            var url = "http://localhost:3000/api/" + collection + "/activitydetail/" + activityname;
            return $http.get(url).then(function(response){
                return response.data;

            });

        };

        var getNoiseWords = function () {

            var url = "http://localhost:3000/data/noisewords.json";
            return $http.get(url).then(function(response){

                return response.data;

            });

        };


        //public gedeelte
        return{

            getCollection:getCollection,
            getByID:getByID,
            getItem:getItem,
            getDetailsUser: getDetailsUser,
            getDetailsActivity: getDetailsActivity,
            getNoiseWords: getNoiseWords

        };

    };

    angular.module("app").factory("dbService", ["$http", dbService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();
/**
 * Created by iman on 5/12/15.
 */
(function(){

    "use strict";

    var matchesService = function () {

        var getMatches = function (nameUser) {

            var variabelURL = "together";
            var localUrl = "http://localhost:3000/data/matches.json";
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", localUrl, false);
            xmlHttp.send(null);

            if(xmlHttp.status == 200) {

                var data = JSON.parse(xmlHttp.responseText);
                var arr = [];
                var arrMatches = [];
                var arrMatchUsers = [];
                var arrMatchInterests = [];

                for(var i=0; i < data.length; i++){

                    var obj = {
                        "user": data[i].user,
                        "matches":data[i].matches
                    };

                    arr.push(obj);

                }

                for(var ii = 0; ii<arr.length; ii++){

                    var index = arr[ii].user.indexOf(nameUser);
                    if(index === 0){
                        arrMatches.push(arr[ii].matches);
                    }
                    //console.log("Index: "+index);
                }

                //console.log(arr);
                //console.log(arrMatches[0]);


                var arrMatchesByUser = arrMatches[0];
                //console.log("Aantal matches: " + arrMatchesByUser.length);

                return arrMatchesByUser;

                /*
                for(var iii = 0; iii<arrMatches[0].length; iii++){

                    var matchUser = arrMatches[0][iii].user;
                    var matchInterests = arrMatches[0][iii].interests;

                    arrMatchUsers.push(matchUser);
                    arrMatchInterests.push(matchInterests);

                    //console.log(matchUser);
                    //console.log(matchInterests);
                }

                console.log(arrMatchUsers);
                console.log(arrMatchInterests);
                */

            }



        };

        //public gedeelte
        return{

            getMatches:getMatches,

        };

    };

    angular.module("app").factory("matchesService", [matchesService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();
/**
 * Created by iman on 5/12/15.
 */

(function() {

    "use strict";
    var ActivitiesController = function ($scope, dbService, $http, $location, $routeParams, $route) {

        $scope.getActivities = function () {
            dbService.getCollection('activities').then(function (response) {

                var arrTemp = response.activitielist;
                var arrActs = [];

                for (var i = 0, l = arrTemp.length; i < l; i++) {
                    if (new Date(arrTemp[i].untilDate).getTime() >= new Date().getTime()) {
                        arrActs.push(arrTemp[i]);
                    }
                }

                $scope.arrActivities = arrActs;

            });


        };

        String.prototype.replaceAll = function( token, newToken, ignoreCase ) {
            var _token;
            var str = this + "";
            var i = -1;

            if ( typeof token === "string" ) {

                if ( ignoreCase ) {

                    _token = token.toLowerCase();

                    while( (
                        i = str.toLowerCase().indexOf(
                            token, i >= 0 ? i + newToken.length : 0
                        ) ) !== -1
                        ) {
                        str = str.substring( 0, i ) +
                            newToken +
                            str.substring( i + token.length );
                    }

                } else {
                    return this.split( token ).join( newToken );
                }

            }
            return str;
        };

        function isInArray(value, array) {
            return array.indexOf(value);
        }

        function getKeywordsFromDescription(description, callback) {

            description = description.replaceAll('.', '');
            description = description.replaceAll(',', '');
            description = description.replaceAll('?', '');
            description = description.replaceAll('!', '');
            description = description.replaceAll('"', '');
            description = description.replaceAll("'", '');

            var words = description.split(" ");
            var keyWords = "";

            dbService.getNoiseWords().then(function(response) {

                var noiseWords = response.noisewords;

                for (var i = 0; i < words.length; i++) {

                    if (isInArray(words[i].toLowerCase(), noiseWords) == -1) {
                        keyWords += words[i];
                        keyWords += " ";
                    }
                }

                //return keyWords;
                if(!keyWords.isEmpty){
                    callback(null, keyWords);
                }

                else{
                    callback("No keywords found.", null);
                }

            });
        }

        $scope.addActivity = function() {
            console.log("ADD ACTIVITY");
            var activityName = this.activityName;
            var street = this.street;
            var number = this.number;
            var zipcode = this.zipcode;
            var description = this.comment;
            var dateFrom = this.dateFrom;
            var dateUntil = this.dateUntil;
            var timestamp = new Date().getTime();
            console.log(street);

            if((street !== undefined) &&
                (number !== undefined) &&
                (zipcode !== undefined) &&
                (description !== undefined) &&
                (dateFrom !== undefined) &&
                (dateUntil !== undefined) &&
                (timestamp !== undefined)){

                if(dateFrom <= dateUntil){
                    $scope.error = "";

                    getKeywordsFromDescription(description, function (error, data) {
                        if(!error){
                            description = data;
                            var url = "http://localhost:3000/api/activities/addactivity";

                            var file = $scope.myFile; 
                            var uploadUrl = "/images/activities/" + file.name;
                            fileUpload.uploadFileToUrl(file, uploadUrl); 
                            console.log(uploadUrl);

                            $http.post(url, {
                             activityName:activityName,
                             street : street,
                             number: number,
                             zipcode: zipcode,
                             description : description,
                             dateFrom : dateFrom,
                             dateUntil : dateUntil,
                             timestamp : timestamp,
                             image: uploadUrl
                             }).success(function (data) {
                             console.log(data);
                                console.log('activity is opgeslaan');
                             $scope.error = data.error;
                             $scope.getActivities();
                             resetForm();
                             //$location.path(data.redirect);
                             });

                        }
                        else{
                            console.log(error);
                        }
                    });


                }
                else if(dateFrom > dateUntil){
                    $scope.error = "ERROR: Date until can't be earlier than date from.";
                }

            }
            else{
                $scope.error = "ERROR: All fields are required.8888";
            }
        };

        $scope.getDetailActivity = function(){
            dbService.getDetailsActivity('activities', $routeParams.activityName).then(function(response){
                $scope.arrDetailsActivity = response.activity;
                initmap();
                return $scope.arrDetailsActivity;


            });
        };

        function recentFirst(a,b) {
            if (a.timestamp > b.timestamp)
                return -1;
            if (a.timestamp < b.timestamp)
                return 1;
            return 0;
        }

        $scope.getMostRecentActivities = function(){
            dbService.getCollection('activities').then(function(response){

                var numberOfActivities = 3;
                var arrTemp = response.activitielist;
                var arrAllActivities = [];

                for (var i = 0, l = arrTemp.length; i < l; i++) {
                    if (new Date(arrTemp[i].untilDate).getTime() > new Date().getTime()) {
                        arrAllActivities.push(arrTemp[i]);
                    }
                }

                arrAllActivities.sort(recentFirst);

                var arrMostRecentActivities = [];

                for(var ii=0; ii<numberOfActivities; ii++){
                    arrMostRecentActivities.push(arrAllActivities[ii]);
                }

                //console.log("[arrAllActivities]: ");
                //console.log(arrAllActivities);
                //console.log("[arrMostRecentActivities]: ");
                //console.log(arrMostRecentActivities);

                $scope.arrMostRecentActivities = arrMostRecentActivities;

            });
        };

        function initmap() {

            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: {lat: 50.8194894, lng: 3.2577076}
            });
            var geocoder = new google.maps.Geocoder();

            geocodeAddress(geocoder, map);


        }

        function geocodeAddress(geocoder, resultsMap) {
            var street = $scope.arrDetailsActivity.street;
            var number = $scope.arrDetailsActivity.number;
            var zipcode = $scope.arrDetailsActivity.zipcode;

            var address = street + " " + number + ", " + zipcode; //hier address uit db instoppen

            geocoder.geocode({'address': address}, function (results, status) {
                if (status === google.maps.GeocoderStatus.OK) {
                    resultsMap.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                    });

                    console.log(marker);

                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }

        function resetForm(){
            var frm = document.getElementsByName('ActivityForm')[0];
            console.log('je komt in de resetform');
            frm.reset();
        }
    };

    angular.module("app").controller("ActivitiesController", ["$scope", "dbService", "$http","$location", "$routeParams","fileUpload", ActivitiesController]);


})();
/**
 * Created by iman on 5/12/15.
 */

(function(){

    "use strict";

    var MatchesController = function($scope, matchesService) {

        $scope.showMatches = function(){

            var nameUser = "Luna";

            var arrMatchesByUser = matchesService.getMatches(nameUser);

            $scope.aantalMatches = arrMatchesByUser.length;

            $scope.arrMatches = arrMatchesByUser;

            var text = "";
            for(var i=0; i<arrMatchesByUser.length; i++){
                text = arrMatchesByUser[i].interests.toString().replace(" ,", " ");
                arrMatchesByUser[i].interests = text;
            }

        };
    };

    angular.module("app").controller("MatchesController", ["$scope", "matchesService", MatchesController]);

})();
/**
 * Created by iman on 20/12/15.
 */


(function(){

    "use strict";

    var ProfilesController = function($scope, $rootScope, $routeParams, dbService) {

        var clicksOnBtn = 0;

        $scope.showDiv = function(){
            $scope.filter = {showFilter:true};
            clicksOnBtn++;

            if(clicksOnBtn > 1){
                $scope.filter = {showFilter:false};
                clicksOnBtn = 0;
            }
        };

        $scope.hideDiv = function(){
            clicksOnBtn = 0;
            $scope.filter = {showFilter:false};
        };

        $scope.showProfiles = function(){

            var username = "";
            if($rootScope.user.username !== undefined){
                username = $rootScope.user.username;
            }

            dbService.getCollection('users').then(function(response){

                var arrProfiles = response.userlist;
                for(var i = 0; i < arrProfiles.length; i++){
                    if(arrProfiles[i].username === username) {
                        arrProfiles.splice(i, 1);
                    }
                }
                for(var ii = 0; ii < arrProfiles.length; ii++){
                    if(arrProfiles[ii].username === "admin") {
                        arrProfiles.splice(ii, 1);
                    }
                }
                $scope.arrProfiles = arrProfiles;

            });

        };

        $scope.sortProperty = "title";
        $scope.filterQuery = "";
        $scope.filterImages = function(i){
            if($scope.filterQuery === ""){
                return true;
            }

            /*
             else if(i.username.toLowerCase().indexOf($scope.filterQuery.toLocaleLowerCase()) >= 0){
             return true;
             }
             */

            else if(i.sex === undefined){
                return false;
            }

            else if($scope.filterQuery.toLowerCase() == i.sex.toLowerCase()){
                return true;
            }

            else if($scope.filterQuery.toLowerCase() === "nofilter"){
                $scope.filterQuery = "";
            }

            return false;
        };
    };

    angular.module("app").controller("ProfilesController", ["$scope", "$rootScope", "$routeParams", "dbService", ProfilesController]);

})();
/**
 * Created by iman on 20/12/15.
 */
(function(){

    "use strict";

    var UsersController = function($scope, $routeParams, dbService) {

        $scope.getUsers = function(){

            dbService.getCollection('users').then(function(response){

                //console.log(response);
                $scope.arrUsers = response.userlist;

            });

        };

        $scope.getDetailUser = function(){

            dbService.getDetailsUser('users', $routeParams.username).then(function(response){
                $scope.arrDetails = response.activity;
            });
        };

        $scope.getUserByID = function(){

            dbService.getItem('user').then(function(response){

                console.log(response);
                $scope.userProfile = response;

            });

        };


    };

    angular.module("app").controller("UsersController", ["$scope", "$routeParams", "dbService", UsersController]);

})();
/**
 * Created by Marthe on 30/12/15.
 */


(function(){
    "use strict";



var locationController = function($scope) {

    console.log('TESTEST');

    $scope.initmap = function() {
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 8,
            center: {lat: 50.8194894, lng: 3.2577076}
        });
        var geocoder = new google.maps.Geocoder();

        geocodeAddress(geocoder, map);

    };

    function geocodeAddress(geocoder, resultsMap) {
        var address = "Graaf Karel de Goedelaan 5, Kortrijk"; //hier address uit db instoppen

        geocoder.geocode({'address': address}, function (results, status) {
            if (status === google.maps.GeocoderStatus.OK) {
                resultsMap.setCenter(results[0].geometry.location);
                var marker = new google.maps.Marker({
                    map: resultsMap,
                    position: results[0].geometry.location
                });

                console.log(marker);

            } else {
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
    }
};

    angular.module("app").controller("locationController", ["$scope", locationController]);
})();
/**
 * Created by Marthe on 15/12/15.
 */
(function(){
    "use strict";
    var selectedInterest = [];

    var loginController = function ($scope, $http, $location) {

        $scope.login = function() {
            $http
                .post('/login', {
                    username: this.username,
                    password: this.password
                })
                .success(function(data) {
                    console.log(data);
                    $scope.error = data.error;
                    $location.path(data.redirect);
                });
        };

        $scope.interests = ['Jazz', 'Hiphop', 'New wave', 'Traveling','Party'];
        $scope.lst = [];
        $scope.change = function(){
            $scope.lst.push('2');
            console.log($scope.lst);
        };
        $scope.stateChanged = function (qId) {
            //if(!$scope.interests[qId]){ //If it is checked
            if(selectedInterest.indexOf(qId) !== -1) {
                //console.log('artNr already exists! DELETE');
                var index = selectedInterest.indexOf(qId);
                if (index > -1) {
                    selectedInterest.splice(index, 1);
                }
            }else{
                selectedInterest.push(qId);
                console.log(selectedInterest);
            }
        };

        $scope.register = function() {
            console.log("REGISTER");


            $http.post('/register', {
                firstname: this.firstname,
                lastname : this.lastname,
                //email : this.email,*/
                username : this.username,
                password : this.password,
                zipcode: this.zipcode,
                birthdate : this.birthdate,
                sex : this.sex,
                biography : this.biography,
                interests:selectedInterest

            }).success(function (data) {
                $scope.error = data.error;
                $location.path(data.redirect);
            });

        };
    };

    var signupController = function ($scope) {
        $scope.categories = [''];
        $scope.newCategory = "";
        $scope.saveCategory = function () {

        };

    };

    var editableCheckboxController = function ($scope) {
        $scope.category = "";
        $scope.showLabel = false;
        $scope.showTextbox = true;
        $scope.saveCategory = function () {
            if ($scope.category) {
                $scope.showLabel = true;
                $scope.showTextbox = false;
            }
            else {
                $scope.showLabel = false;
                $scope.showTextbox = true;
            }
        };
        $scope.edit = function () {
            $scope.showLabel = false;
            $scope.showTextbox = true;
        };
        $scope.isChecked = function(qId){
            console.log(qId);
            if(qId!==  " ") {
                if (selectedInterest.indexOf(qId) !== -1) {
                    var index = selectedInterest.indexOf(qId);
                    if (index > -1) {
                        selectedInterest.splice(index, 1);
                        console.log(selectedInterest);
                    }
                } else {
                    selectedInterest.push(qId);
                    console.log(selectedInterest);
                }
            }
        };
        $scope.stateChanged = function (qId) {

        };

    };

    angular.module("app")
        .controller("loginController", ["$scope", "$http", "$location", loginController])
        .controller("signupController", ["$scope", signupController])
        .controller("editableCheckboxController", ["$scope", editableCheckboxController]);
})();
/**
 * Created by Nikita on 21/12/2015.
 */
(function () {
    "use strict";

    /*var signupController = function ($scope) {
        $scope.categories = [''];
        $scope.newCategory = "";
        $scope.saveCategory = function () {

        };

    };

    var editableCheckboxController = function ($scope) {
        $scope.category = "";
        $scope.showLabel = false;
        $scope.showTextbox = true;
        $scope.saveCategory = function () {
            if ($scope.category) {
                $scope.showLabel = true;
                $scope.showTextbox = false;
            }
            else {
                $scope.showLabel = false;
                $scope.showTextbox = true;
            }
        };
        $scope.edit = function () {
            $scope.showLabel = false;
            $scope.showTextbox = true;
        };

    };
    angular.module("app")
        .controller("signupController", ["$scope", signupController])
        .controller("editableCheckboxController", ["$scope", editableCheckboxController]);*/


})();
/**
 * Created by Marthe on 16/12/15.
 */
(function () {
    "use strict";

    var userController = function ($scope, $rootScope, $http, $location) {
        $http.get('/user').success(function(data) {
            $scope.user = data;
            $rootScope.user = data;

            if(data.username == 'admin'){
                $scope.auth = {isAuth: true, isAdmin : true};
            }
            else if(data.username != 'admin' && data.username !== undefined){
                $scope.auth = {isAuth: true, isAdmin : false};
            }
            else if(data.username === undefined){
                $scope.auth = {isAuth: false, isAdmin : false};

            }


        });


        /*$scope.logout = function() {
            $http.get('/logout').success(function (data) {
                $location.path(data.redirect);
            });
        };*/
    };


    angular.module("app").controller("userController", ["$scope", "$rootScope", "$http", "$location", userController]);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIkFjdGl2aXR5LmpzIiwiYWN0aXZpdGllc1NlcnZpY2UuanMiLCJkYlNlcnZpY2UuanMiLCJtYXRjaGVzU2VydmljZS5qcyIsIkFjdGl2aXRpZXNDb250cm9sbGVyLmpzIiwiTWF0Y2hlc0NvbnRyb2xsZXIuanMiLCJQcm9maWxlc0NvbnRyb2xsZXIuanMiLCJVc2Vyc0NvbnRyb2xsZXIuanMiLCJsb2NhdGlvbkNvbnRyb2xsZXIuanMiLCJsb2dpbkNvbnRyb2xsZXIuanMiLCJzaWdudXBDb250cm9sbGVyLmpzIiwidXNlckNvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBNYXJ0aGUgb24gMTAvMTIvMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIsIFtcIm5nUm91dGVcIl0pO1xuICAgIGFwcC5jb25maWcoZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIpe1xuICAgICAgICAkcm91dGVQcm92aWRlclxuICAgICAgICAgICAgLndoZW4oXCIvXCIse1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vdmlld3MvaG9tZS5odG1sXCJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbihcIi9zaWdudXBcIix7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3Mvc2lnbnVwLmh0bWxcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL2hvbWVcIix7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9ob21lLmh0bWxcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL21hdGNoZXNcIix7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9tYXRjaGVzLmh0bWxcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL2hvd3RvXCIse1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vdmlld3MvaG93VG8uaHRtbFwiXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvYWN0aXZpdGllc1wiLHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL2FjdGl2aXRpZXMuaHRtbFwiXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvYWRtaW5cIix7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9hZG1pbi5odG1sXCJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbihcIi9zZWFyY2hwcm9maWxlc1wiLHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL3NlYXJjaFByb2ZpbGVzLmh0bWxcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL215cHJvZmlsZVwiLHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL215UHJvZmlsZS5odG1sXCJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbihcIi91c2VyZGV0YWlscy86dXNlcm5hbWVcIix7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9kZXRhaWxzVXNlci5odG1sXCIsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1VzZXJzQ29udHJvbGxlcidcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbihcIi9kZXRhaWxzdXNlclwiLHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL2RldGFpbHNVc2VyLmh0bWxcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL2FjdGl2aXR5ZGV0YWlscy86YWN0aXZpdHlOYW1lXCIsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL2RldGFpbHNBY3Rpdml0eS5odG1sXCIsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogXCJBY3Rpdml0aWVzQ29udHJvbGxlclwiXG5cbiAgICAgICAgICAgIH0pO1xuXG5cbiAgICB9KTtcblxuICAgIGFwcC5ydW4oZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcbiAgICAgICAgJHJvb3RTY29wZS51c2VyID0ge307XG4gICAgfSk7XG5cbiAgICBhcHAuZGlyZWN0aXZlKCduZ0VudGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgZWxlbWVudC5iaW5kKFwia2V5ZG93biBrZXlwcmVzc1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kZXZhbChhdHRycy5uZ0VudGVyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9KTtcblxuXG4gICAgYXBwLmRpcmVjdGl2ZSgnZmlsZU1vZGVsJywgWyckcGFyc2UnLCBmdW5jdGlvbiAoJHBhcnNlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gJHBhcnNlKGF0dHJzLmZpbGVNb2RlbCk7XG4gICAgICAgICAgICAgICAgdmFyIG1vZGVsU2V0dGVyID0gbW9kZWwuYXNzaWduO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsU2V0dGVyKHNjb3BlLCBlbGVtZW50WzBdLmZpbGVzWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfV0pO1xuXG4gICAgYXBwLnNlcnZpY2UoJ2ZpbGVVcGxvYWQnLCBbJyRodHRwJywgZnVuY3Rpb24gKCRodHRwKSB7XG4gICAgICAgIHRoaXMudXBsb2FkRmlsZVRvVXJsID0gZnVuY3Rpb24oZmlsZSwgdXBsb2FkVXJsKXtcbiAgICAgICAgICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgZmQuYXBwZW5kKCdmaWxlJywgZmlsZSk7XG4gICAgICAgICAgICAkaHR0cC5wb3N0KHVwbG9hZFVybCwgZmQsIHtcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1SZXF1ZXN0OiBhbmd1bGFyLmlkZW50aXR5LFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogdW5kZWZpbmVkfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInN1Y2Nlc3NcIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9XSk7XG5cblxuICAgIGFwcC5kaXJlY3RpdmUoJ2VkaXRhYmxlQ2hlY2tib3gnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuL3ZpZXdzL2VkaXRhYmxlY2hlY2tib3guaHRtbCdcbiAgICAgICAgfTtcbiAgICB9KTtcblxuXG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBpbWFuIG9uIDE1LzEyLzE1LlxuICovXG52YXIgQWN0aXZpdHkgPSBmdW5jdGlvbihpbWcsIG5hbWUsIHBsYWNlLCBrZXl3b3JkcywgcGFydGljaXBhbnRzLCBteUV2ZW50KXtcbiAgICB0aGlzLmltZyA9IGltZztcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMucGxhY2UgPSBwbGFjZTtcbiAgICB0aGlzLmtleXdvcmRzID0ga2V5d29yZHM7XG4gICAgdGhpcy5wYXJ0aWNpcGFudHMgPSBwYXJ0aWNpcGFudHM7XG4gICAgdGhpcy5teUV2ZW50ID0gbXlFdmVudDtcbn07IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gNS8xMi8xNS5cbiAqL1xuLyooZnVuY3Rpb24oKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIGFjdGl2aXRpZXNTZXJ2aWNlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIHZhciBnZXRBY3Rpdml0aWVzID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgbG9jYWxVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9kYXRhL2FjdGl2aXRpZXMuanNvblwiO1xuICAgICAgICAgICAgdmFyIHhtbEh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHhtbEh0dHAub3BlbihcIkdFVFwiLCBsb2NhbFVybCwgZmFsc2UpO1xuICAgICAgICAgICAgeG1sSHR0cC5zZW5kKG51bGwpO1xuXG4gICAgICAgICAgICBpZih4bWxIdHRwLnN0YXR1cyA9PSAyMDApIHtcblxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZSh4bWxIdHRwLnJlc3BvbnNlVGV4dCk7XG5cbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGFyckFjdGl2aXRpZXMgPSBbXTtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gZGF0YVtpXTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3QWN0aXZpdHkgPSBuZXcgQWN0aXZpdHkoKTtcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkuaW1nID0gZC5pbWc7XG4gICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2aXR5Lm5hbWUgPSBkLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2aXR5LnBsYWNlID0gZC5wbGFjZTtcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkucGFydGljaXBhbnRzID0gZC5wYXJ0aWNpcGFudHM7XG4gICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2aXR5Lm15RXZlbnQgPSBkLm15RXZlbnQ7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSBcIlwiO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaWk9MDsgaWk8IGQua2V5d29yZHMubGVuZ3RoOyBpaSsrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlpID09IGQua2V5d29yZHMubGVuZ3RoLTEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gZC5rZXl3b3Jkc1tpaV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gZC5rZXl3b3Jkc1tpaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCArPSBcIiwgXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBuZXdBY3Rpdml0eS5rZXl3b3JkcyA9IHRleHQ7XG4gICAgICAgICAgICAgICAgICAgIGFyckFjdGl2aXRpZXMucHVzaChuZXdBY3Rpdml0eSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFyckFjdGl2aXRpZXM7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIGdlZGVlbHRlXG4gICAgICAgIHJldHVybntcblxuICAgICAgICAgICAgZ2V0QWN0aXZpdGllczpnZXRBY3Rpdml0aWVzXG5cbiAgICAgICAgfTtcblxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwiYWN0aXZpdGllc1NlcnZpY2VcIiwgW2FjdGl2aXRpZXNTZXJ2aWNlXSk7XG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXiBkZXplIG5hYW0gYmVwYWFsdCB3ZWxrZSBuYWFtIGplIG5vZGlnIGhlYnQgaW4gamUgY29udHJvbGxlciBhbHMgdmVyd2lqemluZyFcblxufSkoKTsqLyIsIi8qKlxuICogQ3JlYXRlZCBieSBpbWFuIG9uIDE1LzEyLzE1LlxuICovXG5cbihmdW5jdGlvbigpe1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICB2YXIgZGJTZXJ2aWNlID0gZnVuY3Rpb24gKCRodHRwKSB7XG5cbiAgICAgICAgdmFyIGdldENvbGxlY3Rpb24gPSBmdW5jdGlvbiAoY29sbGVjdGlvbikge1xuXG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvXCIgKyBjb2xsZWN0aW9uO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRCeUlEID0gZnVuY3Rpb24gKGNvbGxlY3Rpb24sIGlkKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL1wiICsgY29sbGVjdGlvbiArIFwiL1wiICsgaWQ7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldERldGFpbHNVc2VyID0gZnVuY3Rpb24gKGNvbGxlY3Rpb24sIHVzZXJuYW1lKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL1wiICsgY29sbGVjdGlvbiArIFwiL3VzZXJkZXRhaWwvXCIgKyB1c2VybmFtZTtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0SXRlbSA9IGZ1bmN0aW9uKGl0ZW0pe1xuXG4gICAgICAgICAgICB2YXIgdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL1wiICsgaXRlbTtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy91c2VyJykudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0RGV0YWlsc0FjdGl2aXR5ID0gZnVuY3Rpb24gKGNvbGxlY3Rpb24sIGFjdGl2aXR5bmFtZSkge1xuICAgICAgICAgICAgdmFyIHVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9cIiArIGNvbGxlY3Rpb24gKyBcIi9hY3Rpdml0eWRldGFpbC9cIiArIGFjdGl2aXR5bmFtZTtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Tm9pc2VXb3JkcyA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2RhdGEvbm9pc2V3b3Jkcy5qc29uXCI7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8vcHVibGljIGdlZGVlbHRlXG4gICAgICAgIHJldHVybntcblxuICAgICAgICAgICAgZ2V0Q29sbGVjdGlvbjpnZXRDb2xsZWN0aW9uLFxuICAgICAgICAgICAgZ2V0QnlJRDpnZXRCeUlELFxuICAgICAgICAgICAgZ2V0SXRlbTpnZXRJdGVtLFxuICAgICAgICAgICAgZ2V0RGV0YWlsc1VzZXI6IGdldERldGFpbHNVc2VyLFxuICAgICAgICAgICAgZ2V0RGV0YWlsc0FjdGl2aXR5OiBnZXREZXRhaWxzQWN0aXZpdHksXG4gICAgICAgICAgICBnZXROb2lzZVdvcmRzOiBnZXROb2lzZVdvcmRzXG5cbiAgICAgICAgfTtcblxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwiZGJTZXJ2aWNlXCIsIFtcIiRodHRwXCIsIGRiU2VydmljZV0pO1xuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF4gZGV6ZSBuYWFtIGJlcGFhbHQgd2Vsa2UgbmFhbSBqZSBub2RpZyBoZWJ0IGluIGplIGNvbnRyb2xsZXIgYWxzIHZlcndpanppbmchXG5cbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gNS8xMi8xNS5cbiAqL1xuKGZ1bmN0aW9uKCl7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciBtYXRjaGVzU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICB2YXIgZ2V0TWF0Y2hlcyA9IGZ1bmN0aW9uIChuYW1lVXNlcikge1xuXG4gICAgICAgICAgICB2YXIgdmFyaWFiZWxVUkwgPSBcInRvZ2V0aGVyXCI7XG4gICAgICAgICAgICB2YXIgbG9jYWxVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9kYXRhL21hdGNoZXMuanNvblwiO1xuICAgICAgICAgICAgdmFyIHhtbEh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHhtbEh0dHAub3BlbihcIkdFVFwiLCBsb2NhbFVybCwgZmFsc2UpO1xuICAgICAgICAgICAgeG1sSHR0cC5zZW5kKG51bGwpO1xuXG4gICAgICAgICAgICBpZih4bWxIdHRwLnN0YXR1cyA9PSAyMDApIHtcblxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZSh4bWxIdHRwLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgdmFyIGFyciA9IFtdO1xuICAgICAgICAgICAgICAgIHZhciBhcnJNYXRjaGVzID0gW107XG4gICAgICAgICAgICAgICAgdmFyIGFyck1hdGNoVXNlcnMgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgYXJyTWF0Y2hJbnRlcmVzdHMgPSBbXTtcblxuICAgICAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpIDwgZGF0YS5sZW5ndGg7IGkrKyl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlclwiOiBkYXRhW2ldLnVzZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm1hdGNoZXNcIjpkYXRhW2ldLm1hdGNoZXNcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChvYmopO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpaSA9IDA7IGlpPGFyci5sZW5ndGg7IGlpKyspe1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGFycltpaV0udXNlci5pbmRleE9mKG5hbWVVc2VyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoaW5kZXggPT09IDApe1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJyTWF0Y2hlcy5wdXNoKGFycltpaV0ubWF0Y2hlcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIkluZGV4OiBcIitpbmRleCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhhcnIpO1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYXJyTWF0Y2hlc1swXSk7XG5cblxuICAgICAgICAgICAgICAgIHZhciBhcnJNYXRjaGVzQnlVc2VyID0gYXJyTWF0Y2hlc1swXTtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiQWFudGFsIG1hdGNoZXM6IFwiICsgYXJyTWF0Y2hlc0J5VXNlci5sZW5ndGgpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFyck1hdGNoZXNCeVVzZXI7XG5cbiAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgIGZvcih2YXIgaWlpID0gMDsgaWlpPGFyck1hdGNoZXNbMF0ubGVuZ3RoOyBpaWkrKyl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoVXNlciA9IGFyck1hdGNoZXNbMF1baWlpXS51c2VyO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hJbnRlcmVzdHMgPSBhcnJNYXRjaGVzWzBdW2lpaV0uaW50ZXJlc3RzO1xuXG4gICAgICAgICAgICAgICAgICAgIGFyck1hdGNoVXNlcnMucHVzaChtYXRjaFVzZXIpO1xuICAgICAgICAgICAgICAgICAgICBhcnJNYXRjaEludGVyZXN0cy5wdXNoKG1hdGNoSW50ZXJlc3RzKTtcblxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKG1hdGNoVXNlcik7XG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cobWF0Y2hJbnRlcmVzdHMpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyck1hdGNoVXNlcnMpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyck1hdGNoSW50ZXJlc3RzKTtcbiAgICAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICB9XG5cblxuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy9wdWJsaWMgZ2VkZWVsdGVcbiAgICAgICAgcmV0dXJue1xuXG4gICAgICAgICAgICBnZXRNYXRjaGVzOmdldE1hdGNoZXMsXG5cbiAgICAgICAgfTtcblxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwibWF0Y2hlc1NlcnZpY2VcIiwgW21hdGNoZXNTZXJ2aWNlXSk7XG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXiBkZXplIG5hYW0gYmVwYWFsdCB3ZWxrZSBuYWFtIGplIG5vZGlnIGhlYnQgaW4gamUgY29udHJvbGxlciBhbHMgdmVyd2lqemluZyFcblxufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgaW1hbiBvbiA1LzEyLzE1LlxuICovXG5cbihmdW5jdGlvbigpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBBY3Rpdml0aWVzQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsIGRiU2VydmljZSwgJGh0dHAsICRsb2NhdGlvbiwgJHJvdXRlUGFyYW1zLCAkcm91dGUpIHtcblxuICAgICAgICAkc2NvcGUuZ2V0QWN0aXZpdGllcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRiU2VydmljZS5nZXRDb2xsZWN0aW9uKCdhY3Rpdml0aWVzJykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgIHZhciBhcnJUZW1wID0gcmVzcG9uc2UuYWN0aXZpdGllbGlzdDtcbiAgICAgICAgICAgICAgICB2YXIgYXJyQWN0cyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBhcnJUZW1wLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV3IERhdGUoYXJyVGVtcFtpXS51bnRpbERhdGUpLmdldFRpbWUoKSA+PSBuZXcgRGF0ZSgpLmdldFRpbWUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJyQWN0cy5wdXNoKGFyclRlbXBbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFyckFjdGl2aXRpZXMgPSBhcnJBY3RzO1xuXG4gICAgICAgICAgICB9KTtcblxuXG4gICAgICAgIH07XG5cbiAgICAgICAgU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlQWxsID0gZnVuY3Rpb24oIHRva2VuLCBuZXdUb2tlbiwgaWdub3JlQ2FzZSApIHtcbiAgICAgICAgICAgIHZhciBfdG9rZW47XG4gICAgICAgICAgICB2YXIgc3RyID0gdGhpcyArIFwiXCI7XG4gICAgICAgICAgICB2YXIgaSA9IC0xO1xuXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiB0b2tlbiA9PT0gXCJzdHJpbmdcIiApIHtcblxuICAgICAgICAgICAgICAgIGlmICggaWdub3JlQ2FzZSApIHtcblxuICAgICAgICAgICAgICAgICAgICBfdG9rZW4gPSB0b2tlbi50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlKCAoXG4gICAgICAgICAgICAgICAgICAgICAgICBpID0gc3RyLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiwgaSA+PSAwID8gaSArIG5ld1Rva2VuLmxlbmd0aCA6IDBcbiAgICAgICAgICAgICAgICAgICAgICAgICkgKSAhPT0gLTFcbiAgICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RyID0gc3RyLnN1YnN0cmluZyggMCwgaSApICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdUb2tlbiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyLnN1YnN0cmluZyggaSArIHRva2VuLmxlbmd0aCApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zcGxpdCggdG9rZW4gKS5qb2luKCBuZXdUb2tlbiApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN0cjtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBpc0luQXJyYXkodmFsdWUsIGFycmF5KSB7XG4gICAgICAgICAgICByZXR1cm4gYXJyYXkuaW5kZXhPZih2YWx1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRLZXl3b3Jkc0Zyb21EZXNjcmlwdGlvbihkZXNjcmlwdGlvbiwgY2FsbGJhY2spIHtcblxuICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbi5yZXBsYWNlQWxsKCcuJywgJycpO1xuICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbi5yZXBsYWNlQWxsKCcsJywgJycpO1xuICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbi5yZXBsYWNlQWxsKCc/JywgJycpO1xuICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbi5yZXBsYWNlQWxsKCchJywgJycpO1xuICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbi5yZXBsYWNlQWxsKCdcIicsICcnKTtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb24ucmVwbGFjZUFsbChcIidcIiwgJycpO1xuXG4gICAgICAgICAgICB2YXIgd29yZHMgPSBkZXNjcmlwdGlvbi5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICB2YXIga2V5V29yZHMgPSBcIlwiO1xuXG4gICAgICAgICAgICBkYlNlcnZpY2UuZ2V0Tm9pc2VXb3JkcygpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgIHZhciBub2lzZVdvcmRzID0gcmVzcG9uc2Uubm9pc2V3b3JkcztcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd29yZHMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbkFycmF5KHdvcmRzW2ldLnRvTG93ZXJDYXNlKCksIG5vaXNlV29yZHMpID09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlXb3JkcyArPSB3b3Jkc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleVdvcmRzICs9IFwiIFwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9yZXR1cm4ga2V5V29yZHM7XG4gICAgICAgICAgICAgICAgaWYoIWtleVdvcmRzLmlzRW1wdHkpe1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBrZXlXb3Jkcyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soXCJObyBrZXl3b3JkcyBmb3VuZC5cIiwgbnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS5hZGRBY3Rpdml0eSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJBREQgQUNUSVZJVFlcIik7XG4gICAgICAgICAgICB2YXIgYWN0aXZpdHlOYW1lID0gdGhpcy5hY3Rpdml0eU5hbWU7XG4gICAgICAgICAgICB2YXIgc3RyZWV0ID0gdGhpcy5zdHJlZXQ7XG4gICAgICAgICAgICB2YXIgbnVtYmVyID0gdGhpcy5udW1iZXI7XG4gICAgICAgICAgICB2YXIgemlwY29kZSA9IHRoaXMuemlwY29kZTtcbiAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvbiA9IHRoaXMuY29tbWVudDtcbiAgICAgICAgICAgIHZhciBkYXRlRnJvbSA9IHRoaXMuZGF0ZUZyb207XG4gICAgICAgICAgICB2YXIgZGF0ZVVudGlsID0gdGhpcy5kYXRlVW50aWw7XG4gICAgICAgICAgICB2YXIgdGltZXN0YW1wID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzdHJlZXQpO1xuXG4gICAgICAgICAgICBpZigoc3RyZWV0ICE9PSB1bmRlZmluZWQpICYmXG4gICAgICAgICAgICAgICAgKG51bWJlciAhPT0gdW5kZWZpbmVkKSAmJlxuICAgICAgICAgICAgICAgICh6aXBjb2RlICE9PSB1bmRlZmluZWQpICYmXG4gICAgICAgICAgICAgICAgKGRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpICYmXG4gICAgICAgICAgICAgICAgKGRhdGVGcm9tICE9PSB1bmRlZmluZWQpICYmXG4gICAgICAgICAgICAgICAgKGRhdGVVbnRpbCAhPT0gdW5kZWZpbmVkKSAmJlxuICAgICAgICAgICAgICAgICh0aW1lc3RhbXAgIT09IHVuZGVmaW5lZCkpe1xuXG4gICAgICAgICAgICAgICAgaWYoZGF0ZUZyb20gPD0gZGF0ZVVudGlsKXtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gXCJcIjtcblxuICAgICAgICAgICAgICAgICAgICBnZXRLZXl3b3Jkc0Zyb21EZXNjcmlwdGlvbihkZXNjcmlwdGlvbiwgZnVuY3Rpb24gKGVycm9yLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZighZXJyb3Ipe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL2FjdGl2aXRpZXMvYWRkYWN0aXZpdHlcIjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0gJHNjb3BlLm15RmlsZTvigKhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXBsb2FkVXJsID0gXCIvaW1hZ2VzL2FjdGl2aXRpZXMvXCIgKyBmaWxlLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVVwbG9hZC51cGxvYWRGaWxlVG9VcmwoZmlsZSwgdXBsb2FkVXJsKTvigKhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh1cGxvYWRVcmwpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGh0dHAucG9zdCh1cmwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlOYW1lOmFjdGl2aXR5TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWV0IDogc3RyZWV0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgemlwY29kZTogemlwY29kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gOiBkZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUZyb20gOiBkYXRlRnJvbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZVVudGlsIDogZGF0ZVVudGlsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAgOiB0aW1lc3RhbXAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB1cGxvYWRVcmxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2FjdGl2aXR5IGlzIG9wZ2VzbGFhbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWN0aXZpdGllcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldEZvcm0oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kbG9jYXRpb24ucGF0aChkYXRhLnJlZGlyZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYoZGF0ZUZyb20gPiBkYXRlVW50aWwpe1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIkVSUk9SOiBEYXRlIHVudGlsIGNhbid0IGJlIGVhcmxpZXIgdGhhbiBkYXRlIGZyb20uXCI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IFwiRVJST1I6IEFsbCBmaWVsZHMgYXJlIHJlcXVpcmVkLjg4ODhcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZ2V0RGV0YWlsQWN0aXZpdHkgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgZGJTZXJ2aWNlLmdldERldGFpbHNBY3Rpdml0eSgnYWN0aXZpdGllcycsICRyb3V0ZVBhcmFtcy5hY3Rpdml0eU5hbWUpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgICRzY29wZS5hcnJEZXRhaWxzQWN0aXZpdHkgPSByZXNwb25zZS5hY3Rpdml0eTtcbiAgICAgICAgICAgICAgICBpbml0bWFwKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5hcnJEZXRhaWxzQWN0aXZpdHk7XG5cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gcmVjZW50Rmlyc3QoYSxiKSB7XG4gICAgICAgICAgICBpZiAoYS50aW1lc3RhbXAgPiBiLnRpbWVzdGFtcClcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICBpZiAoYS50aW1lc3RhbXAgPCBiLnRpbWVzdGFtcClcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG5cbiAgICAgICAgJHNjb3BlLmdldE1vc3RSZWNlbnRBY3Rpdml0aWVzID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGRiU2VydmljZS5nZXRDb2xsZWN0aW9uKCdhY3Rpdml0aWVzJykudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG5cbiAgICAgICAgICAgICAgICB2YXIgbnVtYmVyT2ZBY3Rpdml0aWVzID0gMztcbiAgICAgICAgICAgICAgICB2YXIgYXJyVGVtcCA9IHJlc3BvbnNlLmFjdGl2aXRpZWxpc3Q7XG4gICAgICAgICAgICAgICAgdmFyIGFyckFsbEFjdGl2aXRpZXMgPSBbXTtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gYXJyVGVtcC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ldyBEYXRlKGFyclRlbXBbaV0udW50aWxEYXRlKS5nZXRUaW1lKCkgPiBuZXcgRGF0ZSgpLmdldFRpbWUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJyQWxsQWN0aXZpdGllcy5wdXNoKGFyclRlbXBbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYXJyQWxsQWN0aXZpdGllcy5zb3J0KHJlY2VudEZpcnN0KTtcblxuICAgICAgICAgICAgICAgIHZhciBhcnJNb3N0UmVjZW50QWN0aXZpdGllcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpaT0wOyBpaTxudW1iZXJPZkFjdGl2aXRpZXM7IGlpKyspe1xuICAgICAgICAgICAgICAgICAgICBhcnJNb3N0UmVjZW50QWN0aXZpdGllcy5wdXNoKGFyckFsbEFjdGl2aXRpZXNbaWldKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiW2FyckFsbEFjdGl2aXRpZXNdOiBcIik7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhhcnJBbGxBY3Rpdml0aWVzKTtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiW2Fyck1vc3RSZWNlbnRBY3Rpdml0aWVzXTogXCIpO1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYXJyTW9zdFJlY2VudEFjdGl2aXRpZXMpO1xuXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFyck1vc3RSZWNlbnRBY3Rpdml0aWVzID0gYXJyTW9zdFJlY2VudEFjdGl2aXRpZXM7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXRtYXAoKSB7XG5cbiAgICAgICAgICAgIHZhciBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICAgICAgICAgIHpvb206IDEyLFxuICAgICAgICAgICAgICAgIGNlbnRlcjoge2xhdDogNTAuODE5NDg5NCwgbG5nOiAzLjI1NzcwNzZ9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciBnZW9jb2RlciA9IG5ldyBnb29nbGUubWFwcy5HZW9jb2RlcigpO1xuXG4gICAgICAgICAgICBnZW9jb2RlQWRkcmVzcyhnZW9jb2RlciwgbWFwKTtcblxuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZW9jb2RlQWRkcmVzcyhnZW9jb2RlciwgcmVzdWx0c01hcCkge1xuICAgICAgICAgICAgdmFyIHN0cmVldCA9ICRzY29wZS5hcnJEZXRhaWxzQWN0aXZpdHkuc3RyZWV0O1xuICAgICAgICAgICAgdmFyIG51bWJlciA9ICRzY29wZS5hcnJEZXRhaWxzQWN0aXZpdHkubnVtYmVyO1xuICAgICAgICAgICAgdmFyIHppcGNvZGUgPSAkc2NvcGUuYXJyRGV0YWlsc0FjdGl2aXR5LnppcGNvZGU7XG5cbiAgICAgICAgICAgIHZhciBhZGRyZXNzID0gc3RyZWV0ICsgXCIgXCIgKyBudW1iZXIgKyBcIiwgXCIgKyB6aXBjb2RlOyAvL2hpZXIgYWRkcmVzcyB1aXQgZGIgaW5zdG9wcGVuXG5cbiAgICAgICAgICAgIGdlb2NvZGVyLmdlb2NvZGUoeydhZGRyZXNzJzogYWRkcmVzc30sIGZ1bmN0aW9uIChyZXN1bHRzLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBnb29nbGUubWFwcy5HZW9jb2RlclN0YXR1cy5PSykge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzTWFwLnNldENlbnRlcihyZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWFwOiByZXN1bHRzTWFwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHJlc3VsdHNbMF0uZ2VvbWV0cnkubG9jYXRpb25cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cobWFya2VyKTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdHZW9jb2RlIHdhcyBub3Qgc3VjY2Vzc2Z1bCBmb3IgdGhlIGZvbGxvd2luZyByZWFzb246ICcgKyBzdGF0dXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVzZXRGb3JtKCl7XG4gICAgICAgICAgICB2YXIgZnJtID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoJ0FjdGl2aXR5Rm9ybScpWzBdO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2plIGtvbXQgaW4gZGUgcmVzZXRmb3JtJyk7XG4gICAgICAgICAgICBmcm0ucmVzZXQoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwiQWN0aXZpdGllc0NvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiZGJTZXJ2aWNlXCIsIFwiJGh0dHBcIixcIiRsb2NhdGlvblwiLCBcIiRyb3V0ZVBhcmFtc1wiLFwiZmlsZVVwbG9hZFwiLCBBY3Rpdml0aWVzQ29udHJvbGxlcl0pO1xuXG5cbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gNS8xMi8xNS5cbiAqL1xuXG4oZnVuY3Rpb24oKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIE1hdGNoZXNDb250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCBtYXRjaGVzU2VydmljZSkge1xuXG4gICAgICAgICRzY29wZS5zaG93TWF0Y2hlcyA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIHZhciBuYW1lVXNlciA9IFwiTHVuYVwiO1xuXG4gICAgICAgICAgICB2YXIgYXJyTWF0Y2hlc0J5VXNlciA9IG1hdGNoZXNTZXJ2aWNlLmdldE1hdGNoZXMobmFtZVVzZXIpO1xuXG4gICAgICAgICAgICAkc2NvcGUuYWFudGFsTWF0Y2hlcyA9IGFyck1hdGNoZXNCeVVzZXIubGVuZ3RoO1xuXG4gICAgICAgICAgICAkc2NvcGUuYXJyTWF0Y2hlcyA9IGFyck1hdGNoZXNCeVVzZXI7XG5cbiAgICAgICAgICAgIHZhciB0ZXh0ID0gXCJcIjtcbiAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpPGFyck1hdGNoZXNCeVVzZXIubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgICAgIHRleHQgPSBhcnJNYXRjaGVzQnlVc2VyW2ldLmludGVyZXN0cy50b1N0cmluZygpLnJlcGxhY2UoXCIgLFwiLCBcIiBcIik7XG4gICAgICAgICAgICAgICAgYXJyTWF0Y2hlc0J5VXNlcltpXS5pbnRlcmVzdHMgPSB0ZXh0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJNYXRjaGVzQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCJtYXRjaGVzU2VydmljZVwiLCBNYXRjaGVzQ29udHJvbGxlcl0pO1xuXG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBpbWFuIG9uIDIwLzEyLzE1LlxuICovXG5cblxuKGZ1bmN0aW9uKCl7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciBQcm9maWxlc0NvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgZGJTZXJ2aWNlKSB7XG5cbiAgICAgICAgdmFyIGNsaWNrc09uQnRuID0gMDtcblxuICAgICAgICAkc2NvcGUuc2hvd0RpdiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0ge3Nob3dGaWx0ZXI6dHJ1ZX07XG4gICAgICAgICAgICBjbGlja3NPbkJ0bisrO1xuXG4gICAgICAgICAgICBpZihjbGlja3NPbkJ0biA+IDEpe1xuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXIgPSB7c2hvd0ZpbHRlcjpmYWxzZX07XG4gICAgICAgICAgICAgICAgY2xpY2tzT25CdG4gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5oaWRlRGl2ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGNsaWNrc09uQnRuID0gMDtcbiAgICAgICAgICAgICRzY29wZS5maWx0ZXIgPSB7c2hvd0ZpbHRlcjpmYWxzZX07XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnNob3dQcm9maWxlcyA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIHZhciB1c2VybmFtZSA9IFwiXCI7XG4gICAgICAgICAgICBpZigkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWUgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWUgPSAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRiU2VydmljZS5nZXRDb2xsZWN0aW9uKCd1c2VycycpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuXG4gICAgICAgICAgICAgICAgdmFyIGFyclByb2ZpbGVzID0gcmVzcG9uc2UudXNlcmxpc3Q7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGFyclByb2ZpbGVzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICAgICAgaWYoYXJyUHJvZmlsZXNbaV0udXNlcm5hbWUgPT09IHVzZXJuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJQcm9maWxlcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yKHZhciBpaSA9IDA7IGlpIDwgYXJyUHJvZmlsZXMubGVuZ3RoOyBpaSsrKXtcbiAgICAgICAgICAgICAgICAgICAgaWYoYXJyUHJvZmlsZXNbaWldLnVzZXJuYW1lID09PSBcImFkbWluXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyclByb2ZpbGVzLnNwbGljZShpaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFyclByb2ZpbGVzID0gYXJyUHJvZmlsZXM7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnNvcnRQcm9wZXJ0eSA9IFwidGl0bGVcIjtcbiAgICAgICAgJHNjb3BlLmZpbHRlclF1ZXJ5ID0gXCJcIjtcbiAgICAgICAgJHNjb3BlLmZpbHRlckltYWdlcyA9IGZ1bmN0aW9uKGkpe1xuICAgICAgICAgICAgaWYoJHNjb3BlLmZpbHRlclF1ZXJ5ID09PSBcIlwiKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICBlbHNlIGlmKGkudXNlcm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCRzY29wZS5maWx0ZXJRdWVyeS50b0xvY2FsZUxvd2VyQ2FzZSgpKSA+PSAwKXtcbiAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgKi9cblxuICAgICAgICAgICAgZWxzZSBpZihpLnNleCA9PT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsc2UgaWYoJHNjb3BlLmZpbHRlclF1ZXJ5LnRvTG93ZXJDYXNlKCkgPT0gaS5zZXgudG9Mb3dlckNhc2UoKSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsc2UgaWYoJHNjb3BlLmZpbHRlclF1ZXJ5LnRvTG93ZXJDYXNlKCkgPT09IFwibm9maWx0ZXJcIil7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlclF1ZXJ5ID0gXCJcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwiUHJvZmlsZXNDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkcm91dGVQYXJhbXNcIiwgXCJkYlNlcnZpY2VcIiwgUHJvZmlsZXNDb250cm9sbGVyXSk7XG5cbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gMjAvMTIvMTUuXG4gKi9cbihmdW5jdGlvbigpe1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICB2YXIgVXNlcnNDb250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsIGRiU2VydmljZSkge1xuXG4gICAgICAgICRzY29wZS5nZXRVc2VycyA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIGRiU2VydmljZS5nZXRDb2xsZWN0aW9uKCd1c2VycycpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFyclVzZXJzID0gcmVzcG9uc2UudXNlcmxpc3Q7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmdldERldGFpbFVzZXIgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBkYlNlcnZpY2UuZ2V0RGV0YWlsc1VzZXIoJ3VzZXJzJywgJHJvdXRlUGFyYW1zLnVzZXJuYW1lKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXJyRGV0YWlscyA9IHJlc3BvbnNlLmFjdGl2aXR5O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmdldFVzZXJCeUlEID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgZGJTZXJ2aWNlLmdldEl0ZW0oJ3VzZXInKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlclByb2ZpbGUgPSByZXNwb25zZTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuXG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJVc2Vyc0NvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiJHJvdXRlUGFyYW1zXCIsIFwiZGJTZXJ2aWNlXCIsIFVzZXJzQ29udHJvbGxlcl0pO1xuXG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBNYXJ0aGUgb24gMzAvMTIvMTUuXG4gKi9cblxuXG4oZnVuY3Rpb24oKXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuXG5cbnZhciBsb2NhdGlvbkNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUpIHtcblxuICAgIGNvbnNvbGUubG9nKCdURVNURVNUJyk7XG5cbiAgICAkc2NvcGUuaW5pdG1hcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgICAgICAgIHpvb206IDgsXG4gICAgICAgICAgICBjZW50ZXI6IHtsYXQ6IDUwLjgxOTQ4OTQsIGxuZzogMy4yNTc3MDc2fVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGdlb2NvZGVyID0gbmV3IGdvb2dsZS5tYXBzLkdlb2NvZGVyKCk7XG5cbiAgICAgICAgZ2VvY29kZUFkZHJlc3MoZ2VvY29kZXIsIG1hcCk7XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZ2VvY29kZUFkZHJlc3MoZ2VvY29kZXIsIHJlc3VsdHNNYXApIHtcbiAgICAgICAgdmFyIGFkZHJlc3MgPSBcIkdyYWFmIEthcmVsIGRlIEdvZWRlbGFhbiA1LCBLb3J0cmlqa1wiOyAvL2hpZXIgYWRkcmVzcyB1aXQgZGIgaW5zdG9wcGVuXG5cbiAgICAgICAgZ2VvY29kZXIuZ2VvY29kZSh7J2FkZHJlc3MnOiBhZGRyZXNzfSwgZnVuY3Rpb24gKHJlc3VsdHMsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gZ29vZ2xlLm1hcHMuR2VvY29kZXJTdGF0dXMuT0spIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzTWFwLnNldENlbnRlcihyZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uKTtcbiAgICAgICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgICAgICAgIG1hcDogcmVzdWx0c01hcCxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHJlc3VsdHNbMF0uZ2VvbWV0cnkubG9jYXRpb25cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1hcmtlcik7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoJ0dlb2NvZGUgd2FzIG5vdCBzdWNjZXNzZnVsIGZvciB0aGUgZm9sbG93aW5nIHJlYXNvbjogJyArIHN0YXR1cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwibG9jYXRpb25Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBsb2NhdGlvbkNvbnRyb2xsZXJdKTtcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IE1hcnRoZSBvbiAxNS8xMi8xNS5cbiAqL1xuKGZ1bmN0aW9uKCl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgdmFyIHNlbGVjdGVkSW50ZXJlc3QgPSBbXTtcblxuICAgIHZhciBsb2dpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7XG5cbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkaHR0cFxuICAgICAgICAgICAgICAgIC5wb3N0KCcvbG9naW4nLCB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gZGF0YS5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmludGVyZXN0cyA9IFsnSmF6eicsICdIaXBob3AnLCAnTmV3IHdhdmUnLCAnVHJhdmVsaW5nJywnUGFydHknXTtcbiAgICAgICAgJHNjb3BlLmxzdCA9IFtdO1xuICAgICAgICAkc2NvcGUuY2hhbmdlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICRzY29wZS5sc3QucHVzaCgnMicpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLmxzdCk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5zdGF0ZUNoYW5nZWQgPSBmdW5jdGlvbiAocUlkKSB7XG4gICAgICAgICAgICAvL2lmKCEkc2NvcGUuaW50ZXJlc3RzW3FJZF0peyAvL0lmIGl0IGlzIGNoZWNrZWRcbiAgICAgICAgICAgIGlmKHNlbGVjdGVkSW50ZXJlc3QuaW5kZXhPZihxSWQpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2FydE5yIGFscmVhZHkgZXhpc3RzISBERUxFVEUnKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBzZWxlY3RlZEludGVyZXN0LmluZGV4T2YocUlkKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEludGVyZXN0LnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbnRlcmVzdC5wdXNoKHFJZCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRJbnRlcmVzdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJFR0lTVEVSXCIpO1xuXG5cbiAgICAgICAgICAgICRodHRwLnBvc3QoJy9yZWdpc3RlcicsIHtcbiAgICAgICAgICAgICAgICBmaXJzdG5hbWU6IHRoaXMuZmlyc3RuYW1lLFxuICAgICAgICAgICAgICAgIGxhc3RuYW1lIDogdGhpcy5sYXN0bmFtZSxcbiAgICAgICAgICAgICAgICAvL2VtYWlsIDogdGhpcy5lbWFpbCwqL1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lIDogdGhpcy51c2VybmFtZSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZCA6IHRoaXMucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgemlwY29kZTogdGhpcy56aXBjb2RlLFxuICAgICAgICAgICAgICAgIGJpcnRoZGF0ZSA6IHRoaXMuYmlydGhkYXRlLFxuICAgICAgICAgICAgICAgIHNleCA6IHRoaXMuc2V4LFxuICAgICAgICAgICAgICAgIGJpb2dyYXBoeSA6IHRoaXMuYmlvZ3JhcGh5LFxuICAgICAgICAgICAgICAgIGludGVyZXN0czpzZWxlY3RlZEludGVyZXN0XG5cbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGRhdGEucmVkaXJlY3QpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHNpZ251cENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlKSB7XG4gICAgICAgICRzY29wZS5jYXRlZ29yaWVzID0gWycnXTtcbiAgICAgICAgJHNjb3BlLm5ld0NhdGVnb3J5ID0gXCJcIjtcbiAgICAgICAgJHNjb3BlLnNhdmVDYXRlZ29yeSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICB9O1xuXG4gICAgfTtcblxuICAgIHZhciBlZGl0YWJsZUNoZWNrYm94Q29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcbiAgICAgICAgJHNjb3BlLmNhdGVnb3J5ID0gXCJcIjtcbiAgICAgICAgJHNjb3BlLnNob3dMYWJlbCA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSB0cnVlO1xuICAgICAgICAkc2NvcGUuc2F2ZUNhdGVnb3J5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5jYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5zaG93TGFiZWwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICRzY29wZS5zaG93VGV4dGJveCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dMYWJlbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICRzY29wZS5zaG93VGV4dGJveCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5lZGl0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLnNob3dMYWJlbCA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLnNob3dUZXh0Ym94ID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmlzQ2hlY2tlZCA9IGZ1bmN0aW9uKHFJZCl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhxSWQpO1xuICAgICAgICAgICAgaWYocUlkIT09ICBcIiBcIikge1xuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEludGVyZXN0LmluZGV4T2YocUlkKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gc2VsZWN0ZWRJbnRlcmVzdC5pbmRleE9mKHFJZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEludGVyZXN0LnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZEludGVyZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSW50ZXJlc3QucHVzaChxSWQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZEludGVyZXN0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5zdGF0ZUNoYW5nZWQgPSBmdW5jdGlvbiAocUlkKSB7XG5cbiAgICAgICAgfTtcblxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKVxuICAgICAgICAuY29udHJvbGxlcihcImxvZ2luQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRsb2NhdGlvblwiLCBsb2dpbkNvbnRyb2xsZXJdKVxuICAgICAgICAuY29udHJvbGxlcihcInNpZ251cENvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIHNpZ251cENvbnRyb2xsZXJdKVxuICAgICAgICAuY29udHJvbGxlcihcImVkaXRhYmxlQ2hlY2tib3hDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBlZGl0YWJsZUNoZWNrYm94Q29udHJvbGxlcl0pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgTmlraXRhIG9uIDIxLzEyLzIwMTUuXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKnZhciBzaWdudXBDb250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSkge1xuICAgICAgICAkc2NvcGUuY2F0ZWdvcmllcyA9IFsnJ107XG4gICAgICAgICRzY29wZS5uZXdDYXRlZ29yeSA9IFwiXCI7XG4gICAgICAgICRzY29wZS5zYXZlQ2F0ZWdvcnkgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgfTtcblxuICAgIH07XG5cbiAgICB2YXIgZWRpdGFibGVDaGVja2JveENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlKSB7XG4gICAgICAgICRzY29wZS5jYXRlZ29yeSA9IFwiXCI7XG4gICAgICAgICRzY29wZS5zaG93TGFiZWwgPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLnNob3dUZXh0Ym94ID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLnNhdmVDYXRlZ29yeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0xhYmVsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICRzY29wZS5zaG93TGFiZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUuZWRpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5zaG93TGFiZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICRzY29wZS5zaG93VGV4dGJveCA9IHRydWU7XG4gICAgICAgIH07XG5cbiAgICB9O1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpXG4gICAgICAgIC5jb250cm9sbGVyKFwic2lnbnVwQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgc2lnbnVwQ29udHJvbGxlcl0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiZWRpdGFibGVDaGVja2JveENvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIGVkaXRhYmxlQ2hlY2tib3hDb250cm9sbGVyXSk7Ki9cblxuXG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBNYXJ0aGUgb24gMTYvMTIvMTUuXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICB2YXIgdXNlckNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7XG4gICAgICAgICRodHRwLmdldCgnL3VzZXInKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IGRhdGE7XG5cbiAgICAgICAgICAgIGlmKGRhdGEudXNlcm5hbWUgPT0gJ2FkbWluJyl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmF1dGggPSB7aXNBdXRoOiB0cnVlLCBpc0FkbWluIDogdHJ1ZX07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGRhdGEudXNlcm5hbWUgIT0gJ2FkbWluJyAmJiBkYXRhLnVzZXJuYW1lICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgICRzY29wZS5hdXRoID0ge2lzQXV0aDogdHJ1ZSwgaXNBZG1pbiA6IGZhbHNlfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoZGF0YS51c2VybmFtZSA9PT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXV0aCA9IHtpc0F1dGg6IGZhbHNlLCBpc0FkbWluIDogZmFsc2V9O1xuXG4gICAgICAgICAgICB9XG5cblxuICAgICAgICB9KTtcblxuXG4gICAgICAgIC8qJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvbG9nb3V0Jykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGRhdGEucmVkaXJlY3QpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07Ki9cbiAgICB9O1xuXG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwidXNlckNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJGxvY2F0aW9uXCIsIHVzZXJDb250cm9sbGVyXSk7XG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
