/**
 * Created by Marthe on 10/12/15.
 */

(function(){
    var app = angular.module("app", ["ngRoute"]);
    app.config(function($routeProvider){
        $routeProvider
            .when("/",{
                templateUrl: "./views/home.html"
            })
            .when("/signup",{
                templateUrl: "views/signup.html"
            })
            .when("/home",{
                templateUrl: "./views/home.html"
            })
            .when("/matches",{
                templateUrl: "./views/matches.html"
            })
            .when("/howto",{
                templateUrl: "./views/howTo.html"
            })
            .when("/activities",{
                templateUrl: "./views/activities.html"
            })
            .when("/admin",{
                templateUrl: "./views/admin.html"
            })
            .when("/searchprofiles",{
                templateUrl: "./views/searchProfiles.html"
            })
            .when("/myprofile",{
                templateUrl: "./views/myProfile.html"
            });

    });
    app.directive('ngEnter', function () {
        return function (scope, element, attrs) {
            element.bind("keydown keypress", function (event) {
                if (event.which === 13) {
                    scope.$apply(function () {
                        scope.$eval(attrs.ngEnter);
                    });

                    event.preventDefault();
                }
            });
        };
    });

    app.directive('editableCheckbox', function () {
        return {
            restrict: 'E',
            templateUrl: './views/editablecheckbox.html'
        };
    });
})();
/**
 * Created by iman on 15/12/15.
 */
var Activity = function(img, name, place, keywords, participants, myEvent){
    this.img = img;
    this.name = name;
    this.place = place;
    this.keywords = keywords;
    this.participants = participants;
    this.myEvent = myEvent;
};
/**
 * Created by iman on 5/12/15.
 */
(function(){

    "use strict";

    var activitiesService = function () {

        var getActivities = function () {

            var localUrl = "http://localhost:3000/data/activities.json";
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", localUrl, false);
            xmlHttp.send(null);

            if(xmlHttp.status == 200) {

                var data = JSON.parse(xmlHttp.responseText);

                //console.log(data);

                var arrActivities = [];

                for (var i = 0; i < data.length; i++) {

                    var d = data[i];

                    var newActivity = new Activity();
                    newActivity.img = d.img;
                    newActivity.name = d.name;
                    newActivity.place = d.place;
                    newActivity.participants = d.participants;
                    newActivity.myEvent = d.myEvent;

                    var text = "";

                    for(var ii=0; ii< d.keywords.length; ii++){
                        if(ii == d.keywords.length-1){
                            text += d.keywords[ii];
                        }
                        else{
                            text += d.keywords[ii];
                            text += ", ";
                        }
                    }

                    newActivity.keywords = text;
                    arrActivities.push(newActivity);
                }

                return arrActivities;

            }

        };

        //public gedeelte
        return{

            getActivities:getActivities

        };

    };

    angular.module("app").factory("activitiesService", [activitiesService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();
/**
 * Created by iman on 15/12/15.
 */

(function(){

    "use strict";

    var dbService = function ($http) {

        var getCollection = function (collection) {


            var url = "http://localhost:3000/api/" + collection;
            return $http.get(url).then(function(response){

                //console.log(response);
                return response.data;

            });

        };

        var getByID = function (collection, id) {


            var url = "http://localhost:3000/api/" + collection + "/" + id;
            return $http.get(url).then(function(response){

                //console.log(response);
                return response.data;

            });

        };

        var getItem = function(item){

            var url = "http://localhost:3000/api/" + item;
            return $http.get('/user').then(function(response){

                return response.data;

            });

        };

        //public gedeelte
        return{

            getCollection:getCollection,
            getByID:getByID,
            getItem:getItem

        };

    };

    angular.module("app").factory("dbService", ["$http", dbService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();
/**
 * Created by iman on 5/12/15.
 */
(function(){

    "use strict";

    var matchesService = function () {

        var getMatches = function (nameUser) {

            var variabelURL = "together";
            var localUrl = "http://localhost:3000/data/matches.json";
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", localUrl, false);
            xmlHttp.send(null);

            if(xmlHttp.status == 200) {

                var data = JSON.parse(xmlHttp.responseText);
                var arr = [];
                var arrMatches = [];
                var arrMatchUsers = [];
                var arrMatchInterests = [];

                for(var i=0; i < data.length; i++){

                    var obj = {
                        "user": data[i].user,
                        "matches":data[i].matches
                    };

                    arr.push(obj);

                }

                for(var ii = 0; ii<arr.length; ii++){

                    var index = arr[ii].user.indexOf(nameUser);
                    if(index === 0){
                        arrMatches.push(arr[ii].matches);
                    }
                    //console.log("Index: "+index);
                }

                //console.log(arr);
                //console.log(arrMatches[0]);


                var arrMatchesByUser = arrMatches[0];
                //console.log("Aantal matches: " + arrMatchesByUser.length);

                return arrMatchesByUser;

                /*
                for(var iii = 0; iii<arrMatches[0].length; iii++){

                    var matchUser = arrMatches[0][iii].user;
                    var matchInterests = arrMatches[0][iii].interests;

                    arrMatchUsers.push(matchUser);
                    arrMatchInterests.push(matchInterests);

                    //console.log(matchUser);
                    //console.log(matchInterests);
                }

                console.log(arrMatchUsers);
                console.log(arrMatchInterests);
                */

            }



        };

        //public gedeelte
        return{

            getMatches:getMatches,

        };

    };

    angular.module("app").factory("matchesService", [matchesService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();
/**
 * Created by iman on 5/12/15.
 */

(function(){

    "use strict";

    var ActivitiesController = function($scope, dbService) {

        $scope.showActivities = function(){

            $scope.arrActivities = dbService.getCollection('users');

        };


        $scope.addActivity = function() {
            console.log("ADD ACTIVITY");

            var street = this.street;
            var number = this.number;
            var zipcode = this.zipcode;
            var comment = this.comment;
            var dateFrom = this.dateFrom;
            var dateUntil = this.dateUntil;
            var timestamp = new Date().getTime();

            if((street !== undefined) &&
                (number !== undefined) &&
                (zipcode !== undefined) &&
                (comment !== undefined) &&
                (dateFrom !== undefined) &&
                (dateUntil !== undefined) &&
                (timestamp !== undefined)){

                if(dateFrom <= dateUntil){
                    $scope.error = "";

                    $http.post('/addactivity', {
                        address : street + " " + number + " " + zipcode,
                        comment : comment,
                        dateFrom : dateFrom,
                        dateUntil : dateUntil,
                        timestamp : timestamp
                    }).success(function (data) {
                        $scope.error = data.error;
                        $location.path(data.redirect);
                    });

                }
                else if(dateFrom > dateUntil){
                    $scope.error = "ERROR: Date until can't be earlier than date from.";
                }

            }
            else{
                $scope.error = "ERROR: All fields are required.";
            }
        };
    };

    angular.module("app").controller("ActivitiesController", ["$scope", "dbService", ActivitiesController]);

})();
/**
 * Created by iman on 5/12/15.
 */

(function(){

    "use strict";

    var MatchesController = function($scope, matchesService) {

        $scope.showMatches = function(){

            var nameUser = "Luna";

            var arrMatchesByUser = matchesService.getMatches(nameUser);

            $scope.aantalMatches = arrMatchesByUser.length;

            $scope.arrMatches = arrMatchesByUser;

            var text = "";
            for(var i=0; i<arrMatchesByUser.length; i++){
                text = arrMatchesByUser[i].interests.toString().replace(" ,", " ");
                arrMatchesByUser[i].interests = text;
            }

        };
    };

    angular.module("app").controller("MatchesController", ["$scope", "matchesService", MatchesController]);

})();
/**
 * Created by iman on 20/12/15.
 */
(function(){

    "use strict";

    var ProfilesController = function($scope, dbService) {

        var clicksOnBtn = 0;

        $scope.showDiv = function(){
            $scope.filter = {showFilter:true};
            clicksOnBtn++;

            if(clicksOnBtn > 1){
                $scope.filter = {showFilter:false};
                clicksOnBtn = 0;
            }
        };

        $scope.hideDiv = function(){
            clicksOnBtn = 0;
            $scope.filter = {showFilter:false};
        };

        $scope.showProfiles = function(){

            dbService.getCollection('users').then(function(response){

                console.log(response);
                $scope.arrProfiles = response.userlist;

            });

        };

        $scope.sortProperty = "title";
        $scope.filterQuery = "";
        $scope.filterImages = function(i){
            if($scope.filterQuery === ""){
                return true;
            }

            /*
             else if(i.username.toLowerCase().indexOf($scope.filterQuery.toLocaleLowerCase()) >= 0){
             return true;
             }
             */

            else if($scope.filterQuery.toLowerCase() == i.username.toLowerCase()){
                return true;
            }

            else if($scope.filterQuery.toLowerCase() === "nofilter"){
                $scope.filterQuery = "";
            }

            return false;
        };
    };

    angular.module("app").controller("ProfilesController", ["$scope", "dbService", ProfilesController]);

})();
/**
 * Created by iman on 20/12/15.
 */
(function(){

    "use strict";

    var UsersController = function($scope, dbService) {

        $scope.getUsers = function(){

            dbService.getCollection('users').then(function(response){

                //console.log(response);
                $scope.arrUsers = response.userlist;

            });

        };

        $scope.getUserByID = function(){

            dbService.getItem('user').then(function(response){

                console.log(response);
                $scope.userProfile = response;

            });

        };
    };

    angular.module("app").controller("UsersController", ["$scope", "dbService", UsersController]);

})();
/**
 * Created by Marthe on 15/12/15.
 */
(function(){
    "use strict";

    var loginController = function ($scope, $http, $location) {

        $scope.login = function() {
            $http
                .post('/login', {
                    username: this.username,
                    password: this.password
                })
                .success(function(data) {
                    console.log(data);
                    $scope.error = data.error;
                    $location.path(data.redirect);
                });
        };

        $scope.register = function() {
            console.log("REGISTER");
            $http.post('/register', {
                /*firstname: this.firstname,
                lastname : this.lastname,
                email : this.email,*/
                username : this.username,
                password : this.password,
                /*birthdate : this.birthdate,
                sex : this.sex,
                zipcode : this.zipcode,
                biography : this.biography*/
            }).success(function (data) {
                $scope.error = data.error;
                $location.path(data.redirect);
            });
        };
    };

    angular.module("app").controller("loginController", ["$scope", "$http", "$location", loginController]);
})();
/**
 * Created by Nikita on 21/12/2015.
 */
(function () {
    "use strict";

    var signupController = function ($scope) {
        $scope.categories = [''];
        $scope.newCategory = "";
        $scope.saveCategory = function () {

        };

    };

    var editableCheckboxController = function ($scope) {
        $scope.category = "";
        $scope.showLabel = false;
        $scope.showTextbox = true;
        $scope.saveCategory = function () {
            if ($scope.category) {
                $scope.showLabel = true;
                $scope.showTextbox = false;
            }
            else {
                $scope.showLabel = false;
                $scope.showTextbox = true;
            }
        };
        $scope.edit = function () {
            $scope.showLabel = false;
            $scope.showTextbox = true;
        };

    };
    angular.module("app")
        .controller("signupController", ["$scope", signupController])
        .controller("editableCheckboxController", ["$scope", editableCheckboxController]);


})();
/**
 * Created by Marthe on 16/12/15.
 */
(function () {
    "use strict";

    var userController = function ( $scope, $http, $location) {
        $http.get('/user').success(function(data) {
            $scope.user = data;

            if(data.username == 'admin'){
                $scope.auth = {isAuth: true, isAdmin : true};
            }
            else if(data.username != 'admin' && data.username !== undefined){
                $scope.auth = {isAuth: true, isAdmin : false};
            }
            else if(data.username === undefined){
                $scope.auth = {isAuth: false, isAdmin : false};

            }


        });

        /*$scope.logout = function() {
            $http.get('/logout').success(function (data) {
                $location.path(data.redirect);
            });
        };*/
    };


    angular.module("app").controller("userController", ["$scope", "$http", "$location", userController]);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIkFjdGl2aXR5LmpzIiwiYWN0aXZpdGllc1NlcnZpY2UuanMiLCJkYlNlcnZpY2UuanMiLCJtYXRjaGVzU2VydmljZS5qcyIsIkFjdGl2aXRpZXNDb250cm9sbGVyLmpzIiwiTWF0Y2hlc0NvbnRyb2xsZXIuanMiLCJQcm9maWxlc0NvbnRyb2xsZXIuanMiLCJVc2Vyc0NvbnRyb2xsZXIuanMiLCJsb2dpbkNvbnRyb2xsZXIuanMiLCJzaWdudXBDb250cm9sbGVyLmpzIiwidXNlckNvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBNYXJ0aGUgb24gMTAvMTIvMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIsIFtcIm5nUm91dGVcIl0pO1xuICAgIGFwcC5jb25maWcoZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIpe1xuICAgICAgICAkcm91dGVQcm92aWRlclxuICAgICAgICAgICAgLndoZW4oXCIvXCIse1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vdmlld3MvaG9tZS5odG1sXCJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbihcIi9zaWdudXBcIix7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3Mvc2lnbnVwLmh0bWxcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL2hvbWVcIix7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9ob21lLmh0bWxcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL21hdGNoZXNcIix7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9tYXRjaGVzLmh0bWxcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL2hvd3RvXCIse1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vdmlld3MvaG93VG8uaHRtbFwiXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvYWN0aXZpdGllc1wiLHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL2FjdGl2aXRpZXMuaHRtbFwiXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oXCIvYWRtaW5cIix7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9hZG1pbi5odG1sXCJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbihcIi9zZWFyY2hwcm9maWxlc1wiLHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL3NlYXJjaFByb2ZpbGVzLmh0bWxcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKFwiL215cHJvZmlsZVwiLHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL215UHJvZmlsZS5odG1sXCJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgfSk7XG4gICAgYXBwLmRpcmVjdGl2ZSgnbmdFbnRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuYmluZChcImtleWRvd24ga2V5cHJlc3NcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAxMykge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMubmdFbnRlcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfSk7XG5cbiAgICBhcHAuZGlyZWN0aXZlKCdlZGl0YWJsZUNoZWNrYm94JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi92aWV3cy9lZGl0YWJsZWNoZWNrYm94Lmh0bWwnXG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBpbWFuIG9uIDE1LzEyLzE1LlxuICovXG52YXIgQWN0aXZpdHkgPSBmdW5jdGlvbihpbWcsIG5hbWUsIHBsYWNlLCBrZXl3b3JkcywgcGFydGljaXBhbnRzLCBteUV2ZW50KXtcbiAgICB0aGlzLmltZyA9IGltZztcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMucGxhY2UgPSBwbGFjZTtcbiAgICB0aGlzLmtleXdvcmRzID0ga2V5d29yZHM7XG4gICAgdGhpcy5wYXJ0aWNpcGFudHMgPSBwYXJ0aWNpcGFudHM7XG4gICAgdGhpcy5teUV2ZW50ID0gbXlFdmVudDtcbn07IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gNS8xMi8xNS5cbiAqL1xuKGZ1bmN0aW9uKCl7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciBhY3Rpdml0aWVzU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICB2YXIgZ2V0QWN0aXZpdGllcyA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIGxvY2FsVXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvZGF0YS9hY3Rpdml0aWVzLmpzb25cIjtcbiAgICAgICAgICAgIHZhciB4bWxIdHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICB4bWxIdHRwLm9wZW4oXCJHRVRcIiwgbG9jYWxVcmwsIGZhbHNlKTtcbiAgICAgICAgICAgIHhtbEh0dHAuc2VuZChudWxsKTtcblxuICAgICAgICAgICAgaWYoeG1sSHR0cC5zdGF0dXMgPT0gMjAwKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoeG1sSHR0cC5yZXNwb25zZVRleHQpO1xuXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhkYXRhKTtcblxuICAgICAgICAgICAgICAgIHZhciBhcnJBY3Rpdml0aWVzID0gW107XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGRhdGFbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0FjdGl2aXR5ID0gbmV3IEFjdGl2aXR5KCk7XG4gICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2aXR5LmltZyA9IGQuaW1nO1xuICAgICAgICAgICAgICAgICAgICBuZXdBY3Rpdml0eS5uYW1lID0gZC5uYW1lO1xuICAgICAgICAgICAgICAgICAgICBuZXdBY3Rpdml0eS5wbGFjZSA9IGQucGxhY2U7XG4gICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2aXR5LnBhcnRpY2lwYW50cyA9IGQucGFydGljaXBhbnRzO1xuICAgICAgICAgICAgICAgICAgICBuZXdBY3Rpdml0eS5teUV2ZW50ID0gZC5teUV2ZW50O1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gXCJcIjtcblxuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGlpPTA7IGlpPCBkLmtleXdvcmRzLmxlbmd0aDsgaWkrKyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpaSA9PSBkLmtleXdvcmRzLmxlbmd0aC0xKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IGQua2V5d29yZHNbaWldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IGQua2V5d29yZHNbaWldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gXCIsIFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkua2V5d29yZHMgPSB0ZXh0O1xuICAgICAgICAgICAgICAgICAgICBhcnJBY3Rpdml0aWVzLnB1c2gobmV3QWN0aXZpdHkpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBhcnJBY3Rpdml0aWVzO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBnZWRlZWx0ZVxuICAgICAgICByZXR1cm57XG5cbiAgICAgICAgICAgIGdldEFjdGl2aXRpZXM6Z2V0QWN0aXZpdGllc1xuXG4gICAgICAgIH07XG5cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuZmFjdG9yeShcImFjdGl2aXRpZXNTZXJ2aWNlXCIsIFthY3Rpdml0aWVzU2VydmljZV0pO1xuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF4gZGV6ZSBuYWFtIGJlcGFhbHQgd2Vsa2UgbmFhbSBqZSBub2RpZyBoZWJ0IGluIGplIGNvbnRyb2xsZXIgYWxzIHZlcndpanppbmchXG5cbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gMTUvMTIvMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciBkYlNlcnZpY2UgPSBmdW5jdGlvbiAoJGh0dHApIHtcblxuICAgICAgICB2YXIgZ2V0Q29sbGVjdGlvbiA9IGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XG5cblxuICAgICAgICAgICAgdmFyIHVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9cIiArIGNvbGxlY3Rpb247XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG5cbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0QnlJRCA9IGZ1bmN0aW9uIChjb2xsZWN0aW9uLCBpZCkge1xuXG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvXCIgKyBjb2xsZWN0aW9uICsgXCIvXCIgKyBpZDtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcblxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRJdGVtID0gZnVuY3Rpb24oaXRlbSl7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvXCIgKyBpdGVtO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL3VzZXInKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcblxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIGdlZGVlbHRlXG4gICAgICAgIHJldHVybntcblxuICAgICAgICAgICAgZ2V0Q29sbGVjdGlvbjpnZXRDb2xsZWN0aW9uLFxuICAgICAgICAgICAgZ2V0QnlJRDpnZXRCeUlELFxuICAgICAgICAgICAgZ2V0SXRlbTpnZXRJdGVtXG5cbiAgICAgICAgfTtcblxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwiZGJTZXJ2aWNlXCIsIFtcIiRodHRwXCIsIGRiU2VydmljZV0pO1xuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF4gZGV6ZSBuYWFtIGJlcGFhbHQgd2Vsa2UgbmFhbSBqZSBub2RpZyBoZWJ0IGluIGplIGNvbnRyb2xsZXIgYWxzIHZlcndpanppbmchXG5cbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gNS8xMi8xNS5cbiAqL1xuKGZ1bmN0aW9uKCl7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciBtYXRjaGVzU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICB2YXIgZ2V0TWF0Y2hlcyA9IGZ1bmN0aW9uIChuYW1lVXNlcikge1xuXG4gICAgICAgICAgICB2YXIgdmFyaWFiZWxVUkwgPSBcInRvZ2V0aGVyXCI7XG4gICAgICAgICAgICB2YXIgbG9jYWxVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9kYXRhL21hdGNoZXMuanNvblwiO1xuICAgICAgICAgICAgdmFyIHhtbEh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHhtbEh0dHAub3BlbihcIkdFVFwiLCBsb2NhbFVybCwgZmFsc2UpO1xuICAgICAgICAgICAgeG1sSHR0cC5zZW5kKG51bGwpO1xuXG4gICAgICAgICAgICBpZih4bWxIdHRwLnN0YXR1cyA9PSAyMDApIHtcblxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZSh4bWxIdHRwLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgdmFyIGFyciA9IFtdO1xuICAgICAgICAgICAgICAgIHZhciBhcnJNYXRjaGVzID0gW107XG4gICAgICAgICAgICAgICAgdmFyIGFyck1hdGNoVXNlcnMgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgYXJyTWF0Y2hJbnRlcmVzdHMgPSBbXTtcblxuICAgICAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpIDwgZGF0YS5sZW5ndGg7IGkrKyl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlclwiOiBkYXRhW2ldLnVzZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm1hdGNoZXNcIjpkYXRhW2ldLm1hdGNoZXNcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChvYmopO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpaSA9IDA7IGlpPGFyci5sZW5ndGg7IGlpKyspe1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGFycltpaV0udXNlci5pbmRleE9mKG5hbWVVc2VyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoaW5kZXggPT09IDApe1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJyTWF0Y2hlcy5wdXNoKGFycltpaV0ubWF0Y2hlcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIkluZGV4OiBcIitpbmRleCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhhcnIpO1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYXJyTWF0Y2hlc1swXSk7XG5cblxuICAgICAgICAgICAgICAgIHZhciBhcnJNYXRjaGVzQnlVc2VyID0gYXJyTWF0Y2hlc1swXTtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiQWFudGFsIG1hdGNoZXM6IFwiICsgYXJyTWF0Y2hlc0J5VXNlci5sZW5ndGgpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFyck1hdGNoZXNCeVVzZXI7XG5cbiAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgIGZvcih2YXIgaWlpID0gMDsgaWlpPGFyck1hdGNoZXNbMF0ubGVuZ3RoOyBpaWkrKyl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoVXNlciA9IGFyck1hdGNoZXNbMF1baWlpXS51c2VyO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hJbnRlcmVzdHMgPSBhcnJNYXRjaGVzWzBdW2lpaV0uaW50ZXJlc3RzO1xuXG4gICAgICAgICAgICAgICAgICAgIGFyck1hdGNoVXNlcnMucHVzaChtYXRjaFVzZXIpO1xuICAgICAgICAgICAgICAgICAgICBhcnJNYXRjaEludGVyZXN0cy5wdXNoKG1hdGNoSW50ZXJlc3RzKTtcblxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKG1hdGNoVXNlcik7XG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cobWF0Y2hJbnRlcmVzdHMpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyck1hdGNoVXNlcnMpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyck1hdGNoSW50ZXJlc3RzKTtcbiAgICAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICB9XG5cblxuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy9wdWJsaWMgZ2VkZWVsdGVcbiAgICAgICAgcmV0dXJue1xuXG4gICAgICAgICAgICBnZXRNYXRjaGVzOmdldE1hdGNoZXMsXG5cbiAgICAgICAgfTtcblxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwibWF0Y2hlc1NlcnZpY2VcIiwgW21hdGNoZXNTZXJ2aWNlXSk7XG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXiBkZXplIG5hYW0gYmVwYWFsdCB3ZWxrZSBuYWFtIGplIG5vZGlnIGhlYnQgaW4gamUgY29udHJvbGxlciBhbHMgdmVyd2lqemluZyFcblxufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgaW1hbiBvbiA1LzEyLzE1LlxuICovXG5cbihmdW5jdGlvbigpe1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICB2YXIgQWN0aXZpdGllc0NvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsIGRiU2VydmljZSkge1xuXG4gICAgICAgICRzY29wZS5zaG93QWN0aXZpdGllcyA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICRzY29wZS5hcnJBY3Rpdml0aWVzID0gZGJTZXJ2aWNlLmdldENvbGxlY3Rpb24oJ3VzZXJzJyk7XG5cbiAgICAgICAgfTtcblxuXG4gICAgICAgICRzY29wZS5hZGRBY3Rpdml0eSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJBREQgQUNUSVZJVFlcIik7XG5cbiAgICAgICAgICAgIHZhciBzdHJlZXQgPSB0aGlzLnN0cmVldDtcbiAgICAgICAgICAgIHZhciBudW1iZXIgPSB0aGlzLm51bWJlcjtcbiAgICAgICAgICAgIHZhciB6aXBjb2RlID0gdGhpcy56aXBjb2RlO1xuICAgICAgICAgICAgdmFyIGNvbW1lbnQgPSB0aGlzLmNvbW1lbnQ7XG4gICAgICAgICAgICB2YXIgZGF0ZUZyb20gPSB0aGlzLmRhdGVGcm9tO1xuICAgICAgICAgICAgdmFyIGRhdGVVbnRpbCA9IHRoaXMuZGF0ZVVudGlsO1xuICAgICAgICAgICAgdmFyIHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG4gICAgICAgICAgICBpZigoc3RyZWV0ICE9PSB1bmRlZmluZWQpICYmXG4gICAgICAgICAgICAgICAgKG51bWJlciAhPT0gdW5kZWZpbmVkKSAmJlxuICAgICAgICAgICAgICAgICh6aXBjb2RlICE9PSB1bmRlZmluZWQpICYmXG4gICAgICAgICAgICAgICAgKGNvbW1lbnQgIT09IHVuZGVmaW5lZCkgJiZcbiAgICAgICAgICAgICAgICAoZGF0ZUZyb20gIT09IHVuZGVmaW5lZCkgJiZcbiAgICAgICAgICAgICAgICAoZGF0ZVVudGlsICE9PSB1bmRlZmluZWQpICYmXG4gICAgICAgICAgICAgICAgKHRpbWVzdGFtcCAhPT0gdW5kZWZpbmVkKSl7XG5cbiAgICAgICAgICAgICAgICBpZihkYXRlRnJvbSA8PSBkYXRlVW50aWwpe1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIlwiO1xuXG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hZGRhY3Rpdml0eScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgOiBzdHJlZXQgKyBcIiBcIiArIG51bWJlciArIFwiIFwiICsgemlwY29kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgOiBjb21tZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUZyb20gOiBkYXRlRnJvbSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVVbnRpbCA6IGRhdGVVbnRpbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcCA6IHRpbWVzdGFtcFxuICAgICAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYoZGF0ZUZyb20gPiBkYXRlVW50aWwpe1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIkVSUk9SOiBEYXRlIHVudGlsIGNhbid0IGJlIGVhcmxpZXIgdGhhbiBkYXRlIGZyb20uXCI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IFwiRVJST1I6IEFsbCBmaWVsZHMgYXJlIHJlcXVpcmVkLlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwiQWN0aXZpdGllc0NvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiZGJTZXJ2aWNlXCIsIEFjdGl2aXRpZXNDb250cm9sbGVyXSk7XG5cbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gNS8xMi8xNS5cbiAqL1xuXG4oZnVuY3Rpb24oKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIE1hdGNoZXNDb250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCBtYXRjaGVzU2VydmljZSkge1xuXG4gICAgICAgICRzY29wZS5zaG93TWF0Y2hlcyA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIHZhciBuYW1lVXNlciA9IFwiTHVuYVwiO1xuXG4gICAgICAgICAgICB2YXIgYXJyTWF0Y2hlc0J5VXNlciA9IG1hdGNoZXNTZXJ2aWNlLmdldE1hdGNoZXMobmFtZVVzZXIpO1xuXG4gICAgICAgICAgICAkc2NvcGUuYWFudGFsTWF0Y2hlcyA9IGFyck1hdGNoZXNCeVVzZXIubGVuZ3RoO1xuXG4gICAgICAgICAgICAkc2NvcGUuYXJyTWF0Y2hlcyA9IGFyck1hdGNoZXNCeVVzZXI7XG5cbiAgICAgICAgICAgIHZhciB0ZXh0ID0gXCJcIjtcbiAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpPGFyck1hdGNoZXNCeVVzZXIubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgICAgIHRleHQgPSBhcnJNYXRjaGVzQnlVc2VyW2ldLmludGVyZXN0cy50b1N0cmluZygpLnJlcGxhY2UoXCIgLFwiLCBcIiBcIik7XG4gICAgICAgICAgICAgICAgYXJyTWF0Y2hlc0J5VXNlcltpXS5pbnRlcmVzdHMgPSB0ZXh0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJNYXRjaGVzQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCJtYXRjaGVzU2VydmljZVwiLCBNYXRjaGVzQ29udHJvbGxlcl0pO1xuXG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBpbWFuIG9uIDIwLzEyLzE1LlxuICovXG4oZnVuY3Rpb24oKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIFByb2ZpbGVzQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgZGJTZXJ2aWNlKSB7XG5cbiAgICAgICAgdmFyIGNsaWNrc09uQnRuID0gMDtcblxuICAgICAgICAkc2NvcGUuc2hvd0RpdiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0ge3Nob3dGaWx0ZXI6dHJ1ZX07XG4gICAgICAgICAgICBjbGlja3NPbkJ0bisrO1xuXG4gICAgICAgICAgICBpZihjbGlja3NPbkJ0biA+IDEpe1xuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXIgPSB7c2hvd0ZpbHRlcjpmYWxzZX07XG4gICAgICAgICAgICAgICAgY2xpY2tzT25CdG4gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5oaWRlRGl2ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGNsaWNrc09uQnRuID0gMDtcbiAgICAgICAgICAgICRzY29wZS5maWx0ZXIgPSB7c2hvd0ZpbHRlcjpmYWxzZX07XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnNob3dQcm9maWxlcyA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIGRiU2VydmljZS5nZXRDb2xsZWN0aW9uKCd1c2VycycpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICRzY29wZS5hcnJQcm9maWxlcyA9IHJlc3BvbnNlLnVzZXJsaXN0O1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5zb3J0UHJvcGVydHkgPSBcInRpdGxlXCI7XG4gICAgICAgICRzY29wZS5maWx0ZXJRdWVyeSA9IFwiXCI7XG4gICAgICAgICRzY29wZS5maWx0ZXJJbWFnZXMgPSBmdW5jdGlvbihpKXtcbiAgICAgICAgICAgIGlmKCRzY29wZS5maWx0ZXJRdWVyeSA9PT0gXCJcIil7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgZWxzZSBpZihpLnVzZXJuYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigkc2NvcGUuZmlsdGVyUXVlcnkudG9Mb2NhbGVMb3dlckNhc2UoKSkgPj0gMCl7XG4gICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgfVxuICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgIGVsc2UgaWYoJHNjb3BlLmZpbHRlclF1ZXJ5LnRvTG93ZXJDYXNlKCkgPT0gaS51c2VybmFtZS50b0xvd2VyQ2FzZSgpKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxzZSBpZigkc2NvcGUuZmlsdGVyUXVlcnkudG9Mb3dlckNhc2UoKSA9PT0gXCJub2ZpbHRlclwiKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyUXVlcnkgPSBcIlwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJQcm9maWxlc0NvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiZGJTZXJ2aWNlXCIsIFByb2ZpbGVzQ29udHJvbGxlcl0pO1xuXG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBpbWFuIG9uIDIwLzEyLzE1LlxuICovXG4oZnVuY3Rpb24oKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIFVzZXJzQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgZGJTZXJ2aWNlKSB7XG5cbiAgICAgICAgJHNjb3BlLmdldFVzZXJzID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgZGJTZXJ2aWNlLmdldENvbGxlY3Rpb24oJ3VzZXJzJykudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG5cbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXJyVXNlcnMgPSByZXNwb25zZS51c2VybGlzdDtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZ2V0VXNlckJ5SUQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBkYlNlcnZpY2UuZ2V0SXRlbSgndXNlcicpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICRzY29wZS51c2VyUHJvZmlsZSA9IHJlc3BvbnNlO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwiVXNlcnNDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcImRiU2VydmljZVwiLCBVc2Vyc0NvbnRyb2xsZXJdKTtcblxufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgTWFydGhlIG9uIDE1LzEyLzE1LlxuICovXG4oZnVuY3Rpb24oKXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciBsb2dpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7XG5cbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkaHR0cFxuICAgICAgICAgICAgICAgIC5wb3N0KCcvbG9naW4nLCB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gZGF0YS5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJFR0lTVEVSXCIpO1xuICAgICAgICAgICAgJGh0dHAucG9zdCgnL3JlZ2lzdGVyJywge1xuICAgICAgICAgICAgICAgIC8qZmlyc3RuYW1lOiB0aGlzLmZpcnN0bmFtZSxcbiAgICAgICAgICAgICAgICBsYXN0bmFtZSA6IHRoaXMubGFzdG5hbWUsXG4gICAgICAgICAgICAgICAgZW1haWwgOiB0aGlzLmVtYWlsLCovXG4gICAgICAgICAgICAgICAgdXNlcm5hbWUgOiB0aGlzLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkIDogdGhpcy5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICAvKmJpcnRoZGF0ZSA6IHRoaXMuYmlydGhkYXRlLFxuICAgICAgICAgICAgICAgIHNleCA6IHRoaXMuc2V4LFxuICAgICAgICAgICAgICAgIHppcGNvZGUgOiB0aGlzLnppcGNvZGUsXG4gICAgICAgICAgICAgICAgYmlvZ3JhcGh5IDogdGhpcy5iaW9ncmFwaHkqL1xuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IGRhdGEuZXJyb3I7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcImxvZ2luQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRsb2NhdGlvblwiLCBsb2dpbkNvbnRyb2xsZXJdKTtcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IE5pa2l0YSBvbiAyMS8xMi8yMDE1LlxuICovXG4oZnVuY3Rpb24gKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIHNpZ251cENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlKSB7XG4gICAgICAgICRzY29wZS5jYXRlZ29yaWVzID0gWycnXTtcbiAgICAgICAgJHNjb3BlLm5ld0NhdGVnb3J5ID0gXCJcIjtcbiAgICAgICAgJHNjb3BlLnNhdmVDYXRlZ29yeSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICB9O1xuXG4gICAgfTtcblxuICAgIHZhciBlZGl0YWJsZUNoZWNrYm94Q29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcbiAgICAgICAgJHNjb3BlLmNhdGVnb3J5ID0gXCJcIjtcbiAgICAgICAgJHNjb3BlLnNob3dMYWJlbCA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSB0cnVlO1xuICAgICAgICAkc2NvcGUuc2F2ZUNhdGVnb3J5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5jYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5zaG93TGFiZWwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICRzY29wZS5zaG93VGV4dGJveCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dMYWJlbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICRzY29wZS5zaG93VGV4dGJveCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5lZGl0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLnNob3dMYWJlbCA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLnNob3dUZXh0Ym94ID0gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgIH07XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIilcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJzaWdudXBDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBzaWdudXBDb250cm9sbGVyXSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJlZGl0YWJsZUNoZWNrYm94Q29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgZWRpdGFibGVDaGVja2JveENvbnRyb2xsZXJdKTtcblxuXG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBNYXJ0aGUgb24gMTYvMTIvMTUuXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICB2YXIgdXNlckNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoICRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikge1xuICAgICAgICAkaHR0cC5nZXQoJy91c2VyJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAkc2NvcGUudXNlciA9IGRhdGE7XG5cbiAgICAgICAgICAgIGlmKGRhdGEudXNlcm5hbWUgPT0gJ2FkbWluJyl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmF1dGggPSB7aXNBdXRoOiB0cnVlLCBpc0FkbWluIDogdHJ1ZX07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGRhdGEudXNlcm5hbWUgIT0gJ2FkbWluJyAmJiBkYXRhLnVzZXJuYW1lICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgICRzY29wZS5hdXRoID0ge2lzQXV0aDogdHJ1ZSwgaXNBZG1pbiA6IGZhbHNlfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoZGF0YS51c2VybmFtZSA9PT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXV0aCA9IHtpc0F1dGg6IGZhbHNlLCBpc0FkbWluIDogZmFsc2V9O1xuXG4gICAgICAgICAgICB9XG5cblxuICAgICAgICB9KTtcblxuICAgICAgICAvKiRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRodHRwLmdldCgnL2xvZ291dCcpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChkYXRhLnJlZGlyZWN0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9OyovXG4gICAgfTtcblxuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcInVzZXJDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiJGxvY2F0aW9uXCIsIHVzZXJDb250cm9sbGVyXSk7XG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
