/**
 * Created by Marthe on 10/12/15.
 */

(function(){
    var app = angular.module("app", ["ngRoute"]);
    app.config(function($routeProvider){
        $routeProvider
            .when("/",{
                templateUrl: "./views/home.html"
            })
            .when("/signup",{
                templateUrl: "views/signup.html"
            })
            .when("/home",{
                templateUrl: "./views/home.html"
            })
            .when("/matches",{
                templateUrl: "./views/matches.html"
            })
            .when("/howto",{
                templateUrl: "./views/howTo.html"
            })
            .when("/activities",{
                templateUrl: "./views/activities.html"
            })
            .when("/admin",{
                templateUrl: "./views/admin.html"
            })
            .when("/searchprofiles",{
                templateUrl: "./views/searchProfiles.html"
            });

    });
    app.directive('ngEnter', function () {
        return function (scope, element, attrs) {
            element.bind("keydown keypress", function (event) {
                if (event.which === 13) {
                    scope.$apply(function () {
                        scope.$eval(attrs.ngEnter);
                    });

                    event.preventDefault();
                }
            });
        };
    });

    app.directive('editableCheckbox', function () {
        return {
            restrict: 'E',
            templateUrl: 'editablecheckbox.html'
        };
    });
})();
/**
 * Created by iman on 15/12/15.
 */
var Activity = function(img, name, place, keywords, participants, myEvent){
    this.img = img;
    this.name = name;
    this.place = place;
    this.keywords = keywords;
    this.participants = participants;
    this.myEvent = myEvent;
};
/**
 * Created by iman on 5/12/15.
 */
(function(){

    "use strict";

    var activitiesService = function () {

        var getActivities = function () {

            var localUrl = "http://localhost:3000/data/activities.json";
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", localUrl, false);
            xmlHttp.send(null);

            if(xmlHttp.status == 200) {

                var data = JSON.parse(xmlHttp.responseText);

                //console.log(data);

                var arrActivities = [];

                for (var i = 0; i < data.length; i++) {

                    var d = data[i];

                    var newActivity = new Activity();
                    newActivity.img = d.img;
                    newActivity.name = d.name;
                    newActivity.place = d.place;
                    newActivity.participants = d.participants;
                    newActivity.myEvent = d.myEvent;

                    var text = "";

                    for(var ii=0; ii< d.keywords.length; ii++){
                        if(ii == d.keywords.length-1){
                            text += d.keywords[ii];
                        }
                        else{
                            text += d.keywords[ii];
                            text += ", ";
                        }
                    }

                    newActivity.keywords = text;
                    arrActivities.push(newActivity);
                }

                return arrActivities;

            }

        };

        //public gedeelte
        return{

            getActivities:getActivities

        };

    };

    angular.module("app").factory("activitiesService", [activitiesService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();
/**
 * Created by iman on 15/12/15.
 */

(function(){

    "use strict";

    var dbService = function ($http) {

        var getCollection = function (collection) {


            var url = "http://localhost:3000/api/" + collection;
            return $http.get(url).then(function(response){

                //console.log(response);
                return response.data;

            });

        };

        var getByID = function (collection, id) {


            var url = "http://localhost:3000/api/" + collection + "/" + id;
            return $http.get(url).then(function(response){

                //console.log(response);
                return response.data;

            });

        };

        //public gedeelte
        return{

            getCollection:getCollection,
            getByID:getByID

        };

    };

    angular.module("app").factory("dbService", ["$http", dbService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();
/**
 * Created by iman on 5/12/15.
 */
(function(){

    "use strict";

    var matchesService = function () {

        var getMatches = function (nameUser) {

            var variabelURL = "together";
            var localUrl = "http://localhost:3000/data/matches.json";
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", localUrl, false);
            xmlHttp.send(null);

            if(xmlHttp.status == 200) {

                var data = JSON.parse(xmlHttp.responseText);
                var arr = [];
                var arrMatches = [];
                var arrMatchUsers = [];
                var arrMatchInterests = [];

                for(var i=0; i < data.length; i++){

                    var obj = {
                        "user": data[i].user,
                        "matches":data[i].matches
                    };

                    arr.push(obj);

                }

                for(var ii = 0; ii<arr.length; ii++){

                    var index = arr[ii].user.indexOf(nameUser);
                    if(index === 0){
                        arrMatches.push(arr[ii].matches);
                    }
                    //console.log("Index: "+index);
                }

                //console.log(arr);
                //console.log(arrMatches[0]);


                var arrMatchesByUser = arrMatches[0];
                //console.log("Aantal matches: " + arrMatchesByUser.length);

                return arrMatchesByUser;

                /*
                for(var iii = 0; iii<arrMatches[0].length; iii++){

                    var matchUser = arrMatches[0][iii].user;
                    var matchInterests = arrMatches[0][iii].interests;

                    arrMatchUsers.push(matchUser);
                    arrMatchInterests.push(matchInterests);

                    //console.log(matchUser);
                    //console.log(matchInterests);
                }

                console.log(arrMatchUsers);
                console.log(arrMatchInterests);
                */

            }



        };

        //public gedeelte
        return{

            getMatches:getMatches,

        };

    };

    angular.module("app").factory("matchesService", [matchesService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();
/**
 * Created by iman on 5/12/15.
 */

(function(){

    "use strict";

    var ActivitiesController = function($scope, dbService) {

        $scope.showActivities = function(){

            $scope.arrActivities = dbService.getCollection('users');

        };
    };

    angular.module("app").controller("ActivitiesController", ["$scope", "dbService", ActivitiesController]);

    /*
     var ActivitiesController = function($scope, activitiesService) {

     $scope.showActivities = function(){

     var arrActivities = activitiesService.getActivities();

     $scope.arrActivities = arrActivities;

     };
     };

     angular.module("app").controller("ActivitiesController", ["$scope", "activitiesService", ActivitiesController]);
     */

})();
/**
 * Created by Marthe on 15/12/15.
 */
(function(){
    "use strict";

    var loginController = function ($scope, $http, $location) {

        $scope.login = function() {
            $http
                .post('/login', {
                    username: this.username,
                    password: this.password
                })
                .success(function(data) {
                    console.log(data);
                    $scope.error = data.error;
                    $location.path(data.redirect);
                });
        };

        $scope.register = function() {
            console.log("REGISTER");
            $http.post('/register', {
                firstname: this.firstname,
                lastname : this.lastname,
                email : this.email,
                username : this.firstname + " " + this.lastname,
                password : this.password,
                birthdate : this.birthdate,
                sex : this.sex,
                zipcode : this.zipcode,
                biography : this.biography
            }).success(function (data) {
                $scope.error = data.error;
                $location.path(data.redirect);
            });
        };
    };

    angular.module("app").controller("loginController", ["$scope", "$http", "$location", loginController]);
})();
/**
 * Created by iman on 5/12/15.
 */

(function(){

    "use strict";

    var MatchesController = function($scope, matchesService) {

        $scope.showMatches = function(){

            var nameUser = "Luna";

            var arrMatchesByUser = matchesService.getMatches(nameUser);

            $scope.aantalMatches = arrMatchesByUser.length;

            $scope.arrMatches = arrMatchesByUser;

            var text = "";
            for(var i=0; i<arrMatchesByUser.length; i++){
                text = arrMatchesByUser[i].interests.toString().replace(" ,", " ");
                arrMatchesByUser[i].interests = text;
            }

        };
    };

    angular.module("app").controller("MatchesController", ["$scope", "matchesService", MatchesController]);

})();
/**
 * Created by iman on 20/12/15.
 */
(function(){

    "use strict";

    var ProfilesController = function($scope, dbService) {

        var clicksOnBtn = 0;

        $scope.showDiv = function(){
            $scope.filter = {showFilter:true};
            clicksOnBtn++;

            if(clicksOnBtn > 1){
                $scope.filter = {showFilter:false};
                clicksOnBtn = 0;
            }
        };

        $scope.hideDiv = function(){
            clicksOnBtn = 0;
            $scope.filter = {showFilter:false};
        };

        $scope.showProfiles = function(){

            dbService.getCollection('users').then(function(response){

                console.log(response);
                $scope.arrProfiles = response.userlist;

            });

        };

        $scope.sortProperty = "title";
        $scope.filterQuery = "";
        $scope.filterImages = function(i){
            if($scope.filterQuery === ""){
                return true;
            }

            /*
             else if(i.username.toLowerCase().indexOf($scope.filterQuery.toLocaleLowerCase()) >= 0){
             return true;
             }
             */

            else if($scope.filterQuery.toLowerCase() == i.username.toLowerCase()){
                return true;
            }

            else if($scope.filterQuery.toLowerCase() === "nofilter"){
                $scope.filterQuery = "";
            }

            return false;
        };
    };

    angular.module("app").controller("ProfilesController", ["$scope", "dbService", ProfilesController]);

})();
/**
 * Created by Nikita on 21/12/2015.
 */
(function () {
    "use strict";

    var signupController = function ($scope) {
        $scope.categories = [''];
        $scope.newCategory = "";
        $scope.saveCategory = function () {

        };

    };

    var editableCheckboxController = function ($scope) {
        $scope.category = "";
        $scope.showLabel = false;
        $scope.showTextbox = true;
        $scope.saveCategory = function () {
            if ($scope.category) {
                $scope.showLabel = true;
                $scope.showTextbox = false;
            }
            else {
                $scope.showLabel = false;
                $scope.showTextbox = true;
            }
        };
        $scope.edit = function () {
            $scope.showLabel = false;
            $scope.showTextbox = true;
        };

    };
    angular.module("app")
        .controller("signupController", ["$scope", signupController])
        .controller("editableCheckboxController", ["$scope", editableCheckboxController]);


})();
/**
 * Created by Marthe on 16/12/15.
 */
(function () {
    "use strict";

    var userController = function ( $scope, $http, $location) {
        $http.get('/user').success(function(data) {
            $scope.user = data;

            if(data.username == 'admin'){
                $scope.auth = {isAuth: true, isAdmin : true};
            }
            else if(data.username != 'admin' && data.username !== undefined){
                $scope.auth = {isAuth: true, isAdmin : false};
            }
            else if(data.username === undefined){
                $scope.auth = {isAuth: false, isAdmin : false};

            }


            //$scope.auth = { data: {}, isAuthenticated:false};


        });

        /*$scope.logout = function() {
            $http.get('/logout').success(function (data) {
                $location.path(data.redirect);
            });
        };*/
    };


    angular.module("app").controller("userController", ["$scope", "$http", "$location", userController]);
})();
/**
 * Created by iman on 20/12/15.
 */
(function(){

    "use strict";

    var UsersController = function($scope, dbService) {

        $scope.getUsers = function(){

            dbService.getCollection('users').then(function(response){

                console.log(response);
                $scope.arrUsers = response.userlist;

            });

        };

        $scope.getUserByID = function(){

            console.log("test");

        };
    };

    angular.module("app").controller("UsersController", ["$scope", "dbService", UsersController]);

})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIkFjdGl2aXR5LmpzIiwiYWN0aXZpdGllc1NlcnZpY2UuanMiLCJkYlNlcnZpY2UuanMiLCJtYXRjaGVzU2VydmljZS5qcyIsIkFjdGl2aXRpZXNDb250cm9sbGVyLmpzIiwibG9naW5Db250cm9sbGVyLmpzIiwiTWF0Y2hlc0NvbnRyb2xsZXIuanMiLCJQcm9maWxlc0NvbnRyb2xsZXIuanMiLCJzaWdudXBDb250cm9sbGVyLmpzIiwidXNlckNvbnRyb2xsZXIuanMiLCJVc2Vyc0NvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWFydGhlIG9uIDEwLzEyLzE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIsIFtcIm5nUm91dGVcIl0pO1xyXG4gICAgYXBwLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlcil7XHJcbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLndoZW4oXCIvXCIse1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9ob21lLmh0bWxcIlxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbihcIi9zaWdudXBcIix7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9zaWdudXAuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKFwiL2hvbWVcIix7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL2hvbWUuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKFwiL21hdGNoZXNcIix7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL21hdGNoZXMuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKFwiL2hvd3RvXCIse1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9ob3dUby5odG1sXCJcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oXCIvYWN0aXZpdGllc1wiLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vdmlld3MvYWN0aXZpdGllcy5odG1sXCJcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oXCIvYWRtaW5cIix7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL2FkbWluLmh0bWxcIlxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbihcIi9zZWFyY2hwcm9maWxlc1wiLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vdmlld3Mvc2VhcmNoUHJvZmlsZXMuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG4gICAgYXBwLmRpcmVjdGl2ZSgnbmdFbnRlcicsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoXCJrZXlkb3duIGtleXByZXNzXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAxMykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsKGF0dHJzLm5nRW50ZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXBwLmRpcmVjdGl2ZSgnZWRpdGFibGVDaGVja2JveCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2VkaXRhYmxlY2hlY2tib3guaHRtbCdcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgaW1hbiBvbiAxNS8xMi8xNS5cclxuICovXHJcbnZhciBBY3Rpdml0eSA9IGZ1bmN0aW9uKGltZywgbmFtZSwgcGxhY2UsIGtleXdvcmRzLCBwYXJ0aWNpcGFudHMsIG15RXZlbnQpe1xyXG4gICAgdGhpcy5pbWcgPSBpbWc7XHJcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgdGhpcy5wbGFjZSA9IHBsYWNlO1xyXG4gICAgdGhpcy5rZXl3b3JkcyA9IGtleXdvcmRzO1xyXG4gICAgdGhpcy5wYXJ0aWNpcGFudHMgPSBwYXJ0aWNpcGFudHM7XHJcbiAgICB0aGlzLm15RXZlbnQgPSBteUV2ZW50O1xyXG59OyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gNS8xMi8xNS5cclxuICovXHJcbihmdW5jdGlvbigpe1xyXG5cclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBhY3Rpdml0aWVzU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgdmFyIGdldEFjdGl2aXRpZXMgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgbG9jYWxVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9kYXRhL2FjdGl2aXRpZXMuanNvblwiO1xyXG4gICAgICAgICAgICB2YXIgeG1sSHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgICAgICB4bWxIdHRwLm9wZW4oXCJHRVRcIiwgbG9jYWxVcmwsIGZhbHNlKTtcclxuICAgICAgICAgICAgeG1sSHR0cC5zZW5kKG51bGwpO1xyXG5cclxuICAgICAgICAgICAgaWYoeG1sSHR0cC5zdGF0dXMgPT0gMjAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHhtbEh0dHAucmVzcG9uc2VUZXh0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhcnJBY3Rpdml0aWVzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gZGF0YVtpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0FjdGl2aXR5ID0gbmV3IEFjdGl2aXR5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkuaW1nID0gZC5pbWc7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkubmFtZSA9IGQubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBuZXdBY3Rpdml0eS5wbGFjZSA9IGQucGxhY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkucGFydGljaXBhbnRzID0gZC5wYXJ0aWNpcGFudHM7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkubXlFdmVudCA9IGQubXlFdmVudDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGlpPTA7IGlpPCBkLmtleXdvcmRzLmxlbmd0aDsgaWkrKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlpID09IGQua2V5d29yZHMubGVuZ3RoLTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCArPSBkLmtleXdvcmRzW2lpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCArPSBkLmtleXdvcmRzW2lpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gXCIsIFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBuZXdBY3Rpdml0eS5rZXl3b3JkcyA9IHRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyQWN0aXZpdGllcy5wdXNoKG5ld0FjdGl2aXR5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyQWN0aXZpdGllcztcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9wdWJsaWMgZ2VkZWVsdGVcclxuICAgICAgICByZXR1cm57XHJcblxyXG4gICAgICAgICAgICBnZXRBY3Rpdml0aWVzOmdldEFjdGl2aXRpZXNcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmZhY3RvcnkoXCJhY3Rpdml0aWVzU2VydmljZVwiLCBbYWN0aXZpdGllc1NlcnZpY2VdKTtcclxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF4gZGV6ZSBuYWFtIGJlcGFhbHQgd2Vsa2UgbmFhbSBqZSBub2RpZyBoZWJ0IGluIGplIGNvbnRyb2xsZXIgYWxzIHZlcndpanppbmchXHJcblxyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gMTUvMTIvMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIGRiU2VydmljZSA9IGZ1bmN0aW9uICgkaHR0cCkge1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q29sbGVjdGlvbiA9IGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgdmFyIHVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9cIiArIGNvbGxlY3Rpb247XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRCeUlEID0gZnVuY3Rpb24gKGNvbGxlY3Rpb24sIGlkKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgdmFyIHVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9cIiArIGNvbGxlY3Rpb24gKyBcIi9cIiArIGlkO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL3B1YmxpYyBnZWRlZWx0ZVxyXG4gICAgICAgIHJldHVybntcclxuXHJcbiAgICAgICAgICAgIGdldENvbGxlY3Rpb246Z2V0Q29sbGVjdGlvbixcclxuICAgICAgICAgICAgZ2V0QnlJRDpnZXRCeUlEXHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwiZGJTZXJ2aWNlXCIsIFtcIiRodHRwXCIsIGRiU2VydmljZV0pO1xyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXiBkZXplIG5hYW0gYmVwYWFsdCB3ZWxrZSBuYWFtIGplIG5vZGlnIGhlYnQgaW4gamUgY29udHJvbGxlciBhbHMgdmVyd2lqemluZyFcclxuXHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgaW1hbiBvbiA1LzEyLzE1LlxyXG4gKi9cclxuKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIG1hdGNoZXNTZXJ2aWNlID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICB2YXIgZ2V0TWF0Y2hlcyA9IGZ1bmN0aW9uIChuYW1lVXNlcikge1xyXG5cclxuICAgICAgICAgICAgdmFyIHZhcmlhYmVsVVJMID0gXCJ0b2dldGhlclwiO1xyXG4gICAgICAgICAgICB2YXIgbG9jYWxVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9kYXRhL21hdGNoZXMuanNvblwiO1xyXG4gICAgICAgICAgICB2YXIgeG1sSHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgICAgICB4bWxIdHRwLm9wZW4oXCJHRVRcIiwgbG9jYWxVcmwsIGZhbHNlKTtcclxuICAgICAgICAgICAgeG1sSHR0cC5zZW5kKG51bGwpO1xyXG5cclxuICAgICAgICAgICAgaWYoeG1sSHR0cC5zdGF0dXMgPT0gMjAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHhtbEh0dHAucmVzcG9uc2VUZXh0KTtcclxuICAgICAgICAgICAgICAgIHZhciBhcnIgPSBbXTtcclxuICAgICAgICAgICAgICAgIHZhciBhcnJNYXRjaGVzID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJyTWF0Y2hVc2VycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyck1hdGNoSW50ZXJlc3RzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpPTA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VyXCI6IGRhdGFbaV0udXNlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJtYXRjaGVzXCI6ZGF0YVtpXS5tYXRjaGVzXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2gob2JqKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpaSA9IDA7IGlpPGFyci5sZW5ndGg7IGlpKyspe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBhcnJbaWldLnVzZXIuaW5kZXhPZihuYW1lVXNlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaW5kZXggPT09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJNYXRjaGVzLnB1c2goYXJyW2lpXS5tYXRjaGVzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIkluZGV4OiBcIitpbmRleCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhhcnIpO1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhhcnJNYXRjaGVzWzBdKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGFyck1hdGNoZXNCeVVzZXIgPSBhcnJNYXRjaGVzWzBdO1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIkFhbnRhbCBtYXRjaGVzOiBcIiArIGFyck1hdGNoZXNCeVVzZXIubGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyTWF0Y2hlc0J5VXNlcjtcclxuXHJcbiAgICAgICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpaWkgPSAwOyBpaWk8YXJyTWF0Y2hlc1swXS5sZW5ndGg7IGlpaSsrKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoVXNlciA9IGFyck1hdGNoZXNbMF1baWlpXS51c2VyO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXRjaEludGVyZXN0cyA9IGFyck1hdGNoZXNbMF1baWlpXS5pbnRlcmVzdHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGFyck1hdGNoVXNlcnMucHVzaChtYXRjaFVzZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFyck1hdGNoSW50ZXJlc3RzLnB1c2gobWF0Y2hJbnRlcmVzdHMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKG1hdGNoVXNlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhtYXRjaEludGVyZXN0cyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJyTWF0Y2hVc2Vycyk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhhcnJNYXRjaEludGVyZXN0cyk7XHJcbiAgICAgICAgICAgICAgICAqL1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vcHVibGljIGdlZGVlbHRlXHJcbiAgICAgICAgcmV0dXJue1xyXG5cclxuICAgICAgICAgICAgZ2V0TWF0Y2hlczpnZXRNYXRjaGVzLFxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuZmFjdG9yeShcIm1hdGNoZXNTZXJ2aWNlXCIsIFttYXRjaGVzU2VydmljZV0pO1xyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXiBkZXplIG5hYW0gYmVwYWFsdCB3ZWxrZSBuYWFtIGplIG5vZGlnIGhlYnQgaW4gamUgY29udHJvbGxlciBhbHMgdmVyd2lqemluZyFcclxuXHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgaW1hbiBvbiA1LzEyLzE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpe1xyXG5cclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBBY3Rpdml0aWVzQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgZGJTZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5zaG93QWN0aXZpdGllcyA9IGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYXJyQWN0aXZpdGllcyA9IGRiU2VydmljZS5nZXRDb2xsZWN0aW9uKCd1c2VycycpO1xyXG5cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwiQWN0aXZpdGllc0NvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiZGJTZXJ2aWNlXCIsIEFjdGl2aXRpZXNDb250cm9sbGVyXSk7XHJcblxyXG4gICAgLypcclxuICAgICB2YXIgQWN0aXZpdGllc0NvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsIGFjdGl2aXRpZXNTZXJ2aWNlKSB7XHJcblxyXG4gICAgICRzY29wZS5zaG93QWN0aXZpdGllcyA9IGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgIHZhciBhcnJBY3Rpdml0aWVzID0gYWN0aXZpdGllc1NlcnZpY2UuZ2V0QWN0aXZpdGllcygpO1xyXG5cclxuICAgICAkc2NvcGUuYXJyQWN0aXZpdGllcyA9IGFyckFjdGl2aXRpZXM7XHJcblxyXG4gICAgIH07XHJcbiAgICAgfTtcclxuXHJcbiAgICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcIkFjdGl2aXRpZXNDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcImFjdGl2aXRpZXNTZXJ2aWNlXCIsIEFjdGl2aXRpZXNDb250cm9sbGVyXSk7XHJcbiAgICAgKi9cclxuXHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWFydGhlIG9uIDE1LzEyLzE1LlxyXG4gKi9cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgbG9naW5Db250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikge1xyXG5cclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJGh0dHBcclxuICAgICAgICAgICAgICAgIC5wb3N0KCcvbG9naW4nLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMucGFzc3dvcmRcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gZGF0YS5lcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChkYXRhLnJlZGlyZWN0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJFR0lTVEVSXCIpO1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCcvcmVnaXN0ZXInLCB7XHJcbiAgICAgICAgICAgICAgICBmaXJzdG5hbWU6IHRoaXMuZmlyc3RuYW1lLFxyXG4gICAgICAgICAgICAgICAgbGFzdG5hbWUgOiB0aGlzLmxhc3RuYW1lLFxyXG4gICAgICAgICAgICAgICAgZW1haWwgOiB0aGlzLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWUgOiB0aGlzLmZpcnN0bmFtZSArIFwiIFwiICsgdGhpcy5sYXN0bmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkIDogdGhpcy5wYXNzd29yZCxcclxuICAgICAgICAgICAgICAgIGJpcnRoZGF0ZSA6IHRoaXMuYmlydGhkYXRlLFxyXG4gICAgICAgICAgICAgICAgc2V4IDogdGhpcy5zZXgsXHJcbiAgICAgICAgICAgICAgICB6aXBjb2RlIDogdGhpcy56aXBjb2RlLFxyXG4gICAgICAgICAgICAgICAgYmlvZ3JhcGh5IDogdGhpcy5iaW9ncmFwaHlcclxuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gZGF0YS5lcnJvcjtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGRhdGEucmVkaXJlY3QpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwibG9naW5Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiJGxvY2F0aW9uXCIsIGxvZ2luQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gNS8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuXHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgTWF0Y2hlc0NvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsIG1hdGNoZXNTZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5zaG93TWF0Y2hlcyA9IGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICB2YXIgbmFtZVVzZXIgPSBcIkx1bmFcIjtcclxuXHJcbiAgICAgICAgICAgIHZhciBhcnJNYXRjaGVzQnlVc2VyID0gbWF0Y2hlc1NlcnZpY2UuZ2V0TWF0Y2hlcyhuYW1lVXNlcik7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYWFudGFsTWF0Y2hlcyA9IGFyck1hdGNoZXNCeVVzZXIubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmFyck1hdGNoZXMgPSBhcnJNYXRjaGVzQnlVc2VyO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRleHQgPSBcIlwiO1xyXG4gICAgICAgICAgICBmb3IodmFyIGk9MDsgaTxhcnJNYXRjaGVzQnlVc2VyLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIHRleHQgPSBhcnJNYXRjaGVzQnlVc2VyW2ldLmludGVyZXN0cy50b1N0cmluZygpLnJlcGxhY2UoXCIgLFwiLCBcIiBcIik7XHJcbiAgICAgICAgICAgICAgICBhcnJNYXRjaGVzQnlVc2VyW2ldLmludGVyZXN0cyA9IHRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcIk1hdGNoZXNDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIm1hdGNoZXNTZXJ2aWNlXCIsIE1hdGNoZXNDb250cm9sbGVyXSk7XHJcblxyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gMjAvMTIvMTUuXHJcbiAqL1xyXG4oZnVuY3Rpb24oKXtcclxuXHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgUHJvZmlsZXNDb250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCBkYlNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgdmFyIGNsaWNrc09uQnRuID0gMDtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNob3dEaXYgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0ge3Nob3dGaWx0ZXI6dHJ1ZX07XHJcbiAgICAgICAgICAgIGNsaWNrc09uQnRuKys7XHJcblxyXG4gICAgICAgICAgICBpZihjbGlja3NPbkJ0biA+IDEpe1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlciA9IHtzaG93RmlsdGVyOmZhbHNlfTtcclxuICAgICAgICAgICAgICAgIGNsaWNrc09uQnRuID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5oaWRlRGl2ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgY2xpY2tzT25CdG4gPSAwO1xyXG4gICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0ge3Nob3dGaWx0ZXI6ZmFsc2V9O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zaG93UHJvZmlsZXMgPSBmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgZGJTZXJ2aWNlLmdldENvbGxlY3Rpb24oJ3VzZXJzJykudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFyclByb2ZpbGVzID0gcmVzcG9uc2UudXNlcmxpc3Q7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNvcnRQcm9wZXJ0eSA9IFwidGl0bGVcIjtcclxuICAgICAgICAkc2NvcGUuZmlsdGVyUXVlcnkgPSBcIlwiO1xyXG4gICAgICAgICRzY29wZS5maWx0ZXJJbWFnZXMgPSBmdW5jdGlvbihpKXtcclxuICAgICAgICAgICAgaWYoJHNjb3BlLmZpbHRlclF1ZXJ5ID09PSBcIlwiKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICAgZWxzZSBpZihpLnVzZXJuYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigkc2NvcGUuZmlsdGVyUXVlcnkudG9Mb2NhbGVMb3dlckNhc2UoKSkgPj0gMCl7XHJcbiAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICovXHJcblxyXG4gICAgICAgICAgICBlbHNlIGlmKCRzY29wZS5maWx0ZXJRdWVyeS50b0xvd2VyQ2FzZSgpID09IGkudXNlcm5hbWUudG9Mb3dlckNhc2UoKSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZWxzZSBpZigkc2NvcGUuZmlsdGVyUXVlcnkudG9Mb3dlckNhc2UoKSA9PT0gXCJub2ZpbHRlclwiKXtcclxuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJRdWVyeSA9IFwiXCI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwiUHJvZmlsZXNDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcImRiU2VydmljZVwiLCBQcm9maWxlc0NvbnRyb2xsZXJdKTtcclxuXHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTmlraXRhIG9uIDIxLzEyLzIwMTUuXHJcbiAqL1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIHNpZ251cENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlKSB7XHJcbiAgICAgICAgJHNjb3BlLmNhdGVnb3JpZXMgPSBbJyddO1xyXG4gICAgICAgICRzY29wZS5uZXdDYXRlZ29yeSA9IFwiXCI7XHJcbiAgICAgICAgJHNjb3BlLnNhdmVDYXRlZ29yeSA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBlZGl0YWJsZUNoZWNrYm94Q29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcclxuICAgICAgICAkc2NvcGUuY2F0ZWdvcnkgPSBcIlwiO1xyXG4gICAgICAgICRzY29wZS5zaG93TGFiZWwgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSB0cnVlO1xyXG4gICAgICAgICRzY29wZS5zYXZlQ2F0ZWdvcnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuY2F0ZWdvcnkpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93TGFiZWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dUZXh0Ym94ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0xhYmVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuZWRpdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dMYWJlbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgfTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJzaWdudXBDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBzaWdudXBDb250cm9sbGVyXSlcclxuICAgICAgICAuY29udHJvbGxlcihcImVkaXRhYmxlQ2hlY2tib3hDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBlZGl0YWJsZUNoZWNrYm94Q29udHJvbGxlcl0pO1xyXG5cclxuXHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWFydGhlIG9uIDE2LzEyLzE1LlxyXG4gKi9cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciB1c2VyQ29udHJvbGxlciA9IGZ1bmN0aW9uICggJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7XHJcbiAgICAgICAgJGh0dHAuZ2V0KCcvdXNlcicpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAkc2NvcGUudXNlciA9IGRhdGE7XHJcblxyXG4gICAgICAgICAgICBpZihkYXRhLnVzZXJuYW1lID09ICdhZG1pbicpe1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmF1dGggPSB7aXNBdXRoOiB0cnVlLCBpc0FkbWluIDogdHJ1ZX07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZihkYXRhLnVzZXJuYW1lICE9ICdhZG1pbicgJiYgZGF0YS51c2VybmFtZSAhPT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hdXRoID0ge2lzQXV0aDogdHJ1ZSwgaXNBZG1pbiA6IGZhbHNlfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmKGRhdGEudXNlcm5hbWUgPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXV0aCA9IHtpc0F1dGg6IGZhbHNlLCBpc0FkbWluIDogZmFsc2V9O1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIC8vJHNjb3BlLmF1dGggPSB7IGRhdGE6IHt9LCBpc0F1dGhlbnRpY2F0ZWQ6ZmFsc2V9O1xyXG5cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8qJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJy9sb2dvdXQnKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChkYXRhLnJlZGlyZWN0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTsqL1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcInVzZXJDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiJGxvY2F0aW9uXCIsIHVzZXJDb250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgaW1hbiBvbiAyMC8xMi8xNS5cclxuICovXHJcbihmdW5jdGlvbigpe1xyXG5cclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBVc2Vyc0NvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsIGRiU2VydmljZSkge1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0VXNlcnMgPSBmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgZGJTZXJ2aWNlLmdldENvbGxlY3Rpb24oJ3VzZXJzJykudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFyclVzZXJzID0gcmVzcG9uc2UudXNlcmxpc3Q7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmdldFVzZXJCeUlEID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidGVzdFwiKTtcclxuXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcIlVzZXJzQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCJkYlNlcnZpY2VcIiwgVXNlcnNDb250cm9sbGVyXSk7XHJcblxyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
