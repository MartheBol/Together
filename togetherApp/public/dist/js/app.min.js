/**
 * Created by Marthe on 10/12/15.
 */

(function(){
    var app = angular.module("app", ["ngRoute"]);
    app.config(function($routeProvider){
        $routeProvider
            .when("/",{
                templateUrl: "./views/home.html"
            })
            .when("/signup",{
                templateUrl: "views/signup.html"
            })
            .when("/home",{
                templateUrl: "./views/home.html"
            })
            .when("/matches",{
                templateUrl: "./views/matches.html"
            })
            .when("/howto",{
                templateUrl: "./views/howTo.html"
            })
            .when("/activities",{
                templateUrl: "./views/activities.html"
            })
            .when("/admin",{
                templateUrl: "./views/admin.html"
            })
            .when("/searchprofiles",{
                templateUrl: "./views/searchProfiles.html"
            })
            .when("/myprofile",{
                templateUrl: "./views/myProfile.html"
            })
            .when("/userdetails/:username",{
                templateUrl: "./views/detailsUser.html",
                controller: 'UsersController'
            })
            .when("/detailsuser",{
                templateUrl: "./views/detailsUser.html"
            })
            .when("/activitydetails/:activityName", {
                templateUrl: "./views/detailsActivity.html",
                controller: "ActivitiesController"

            });


    });

    app.run(function ($rootScope) {
        $rootScope.user = {};
    });

    app.directive('ngEnter', function () {
        return function (scope, element, attrs) {
            element.bind("keydown keypress", function (event) {
                if (event.which === 13) {
                    scope.$apply(function () {
                        scope.$eval(attrs.ngEnter);
                    });

                    event.preventDefault();
                }
            });
        };
    });


    app.directive('fileModel', ['$parse', function ($parse) {
        return {
            restrict: 'A',
            link: function(scope, element, attrs) {
                var model = $parse(attrs.fileModel);
                var modelSetter = model.assign;

                element.bind('change', function(){
                    scope.$apply(function(){
                        modelSetter(scope, element[0].files[0]);
                    });
                });
            }
        };
    }]);

    app.service('fileUpload', ['$http', function ($http) {
        this.uploadFileToUrl = function(file, uploadUrl){
            var fd = new FormData();
            fd.append('file', file);
            $http.post(uploadUrl, fd, {
                transformRequest: angular.identity,
                headers: {'Content-Type': undefined}
            })
                .success(function(){
                    console.log("success");
                })
                .error(function(){
                    console.log("error");
                });
        };
    }]);


    app.directive('editableCheckbox', function () {
        return {
            restrict: 'E',
            templateUrl: './views/editablecheckbox.html'
        };
    });


})();
/**
 * Created by iman on 15/12/15.
 */
var Activity = function(img, name, place, keywords, participants, myEvent){
    this.img = img;
    this.name = name;
    this.place = place;
    this.keywords = keywords;
    this.participants = participants;
    this.myEvent = myEvent;
};
/**
 * Created by iman on 5/12/15.
 */
/*(function(){

    "use strict";

    var activitiesService = function () {

        var getActivities = function () {

            var localUrl = "http://localhost:3000/data/activities.json";
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", localUrl, false);
            xmlHttp.send(null);

            if(xmlHttp.status == 200) {

                var data = JSON.parse(xmlHttp.responseText);

                //console.log(data);

                var arrActivities = [];

                for (var i = 0; i < data.length; i++) {

                    var d = data[i];

                    var newActivity = new Activity();
                    newActivity.img = d.img;
                    newActivity.name = d.name;
                    newActivity.place = d.place;
                    newActivity.participants = d.participants;
                    newActivity.myEvent = d.myEvent;

                    var text = "";

                    for(var ii=0; ii< d.keywords.length; ii++){
                        if(ii == d.keywords.length-1){
                            text += d.keywords[ii];
                        }
                        else{
                            text += d.keywords[ii];
                            text += ", ";
                        }
                    }

                    newActivity.keywords = text;
                    arrActivities.push(newActivity);
                }

                return arrActivities;

            }

        };

        //public gedeelte
        return{

            getActivities:getActivities

        };

    };

    angular.module("app").factory("activitiesService", [activitiesService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();*/
/**
 * Created by iman on 15/12/15.
 */

(function(){

    "use strict";

    var dbService = function ($http) {

        var getCollection = function (collection) {


            var url = "http://localhost:3000/api/" + collection;
            return $http.get(url).then(function(response){
                return response.data;

            });

        };

        var getByID = function (collection, id) {
            var url = "http://localhost:3000/api/" + collection + "/" + id;
            return $http.get(url).then(function(response){
                return response.data;

            });

        };

        var getDetailsUser = function (collection, username) {
            var url = "http://localhost:3000/api/" + collection + "/userdetail/" + username;
            return $http.get(url).then(function(response){
                return response.data;

            });

        };

        var getItem = function(item){

            var url = "http://localhost:3000/api/" + item;
            return $http.get('/user').then(function(response){

                return response.data;

            });

        };

        var getDetailsActivity = function (collection, activityname) {
            var url = "http://localhost:3000/api/" + collection + "/activitydetail/" + activityname;
            return $http.get(url).then(function(response){
                return response.data;

            });

        };

        var getNoiseWords = function () {

            var url = "http://localhost:3000/data/noisewords.json";
            return $http.get(url).then(function(response){

                return response.data;

            });

        };


        //public gedeelte
        return{

            getCollection:getCollection,
            getByID:getByID,
            getItem:getItem,
            getDetailsUser: getDetailsUser,
            getDetailsActivity: getDetailsActivity,
            getNoiseWords: getNoiseWords

        };

    };

    angular.module("app").factory("dbService", ["$http", dbService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();
/**
 * Created by iman on 5/12/15.
 */
(function(){

    "use strict";

    var matchesService = function () {

        var getMatches = function (nameUser) {

            var variabelURL = "together";
            var localUrl = "http://localhost:3000/data/matches.json";
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", localUrl, false);
            xmlHttp.send(null);

            if(xmlHttp.status == 200) {

                var data = JSON.parse(xmlHttp.responseText);
                var arr = [];
                var arrMatches = [];
                var arrMatchUsers = [];
                var arrMatchInterests = [];

                for(var i=0; i < data.length; i++){

                    var obj = {
                        "user": data[i].user,
                        "matches":data[i].matches
                    };

                    arr.push(obj);

                }

                for(var ii = 0; ii<arr.length; ii++){

                    var index = arr[ii].user.indexOf(nameUser);
                    if(index === 0){
                        arrMatches.push(arr[ii].matches);
                    }
                    //console.log("Index: "+index);
                }

                //console.log(arr);
                //console.log(arrMatches[0]);


                var arrMatchesByUser = arrMatches[0];
                //console.log("Aantal matches: " + arrMatchesByUser.length);

                return arrMatchesByUser;

                /*
                for(var iii = 0; iii<arrMatches[0].length; iii++){

                    var matchUser = arrMatches[0][iii].user;
                    var matchInterests = arrMatches[0][iii].interests;

                    arrMatchUsers.push(matchUser);
                    arrMatchInterests.push(matchInterests);

                    //console.log(matchUser);
                    //console.log(matchInterests);
                }

                console.log(arrMatchUsers);
                console.log(arrMatchInterests);
                */

            }



        };

        //public gedeelte
        return{

            getMatches:getMatches,

        };

    };

    angular.module("app").factory("matchesService", [matchesService]);
    //                                  ^ deze naam bepaalt welke naam je nodig hebt in je controller als verwijzing!

})();
/**
 * Created by iman on 5/12/15.
 */

(function() {

    "use strict";
    var ActivitiesController = function ($scope, dbService, $http, $location, $routeParams, $route) {
        $scope.interestedAct=true;
        $scope.nameButton = "Interested";

        $scope.getActivities = function () {
            dbService.getCollection('activities').then(function (response) {

                var arrTemp = response.activitielist;
                var arrActs = [];

                for (var i = 0, l = arrTemp.length; i < l; i++) {
                    if (new Date(arrTemp[i].untilDate).getTime() >= new Date().getTime()) {
                        arrActs.push(arrTemp[i]);
                    }
                }

                $scope.arrActivities = arrActs;

            });


        };

        String.prototype.replaceAll = function( token, newToken, ignoreCase ) {
            var _token;
            var str = this + "";
            var i = -1;

            if ( typeof token === "string" ) {

                if ( ignoreCase ) {

                    _token = token.toLowerCase();

                    while( (
                        i = str.toLowerCase().indexOf(
                            token, i >= 0 ? i + newToken.length : 0
                        ) ) !== -1
                        ) {
                        str = str.substring( 0, i ) +
                            newToken +
                            str.substring( i + token.length );
                    }

                } else {
                    return this.split( token ).join( newToken );
                }

            }
            return str;
        };

        function isInArray(value, array) {
            return array.indexOf(value);
        }

        function getKeywordsFromDescription(description, callback) {

            description = description.replaceAll('.', '');
            description = description.replaceAll(',', '');
            description = description.replaceAll('?', '');
            description = description.replaceAll('!', '');
            description = description.replaceAll('"', '');
            description = description.replaceAll("'", '');

            var words = description.split(" ");
            var keyWords = "";

            dbService.getNoiseWords().then(function(response) {

                var noiseWords = response.noisewords;

                for (var i = 0; i < words.length; i++) {

                    if (isInArray(words[i].toLowerCase(), noiseWords) == -1) {
                        keyWords += words[i];
                        keyWords += " ";
                    }
                }

                //return keyWords;
                if(!keyWords.isEmpty){
                    callback(null, keyWords);
                }

                else{
                    callback("No keywords found.", null);
                }

            });
        }

        $scope.addActivity = function() {
            console.log("ADD ACTIVITY");
            var activityName = this.activityName;
            var street = this.street;
            var number = this.number;
            var zipcode = this.zipcode;
            var description = this.comment;
            var dateFrom = this.dateFrom;
            var dateUntil = this.dateUntil;
            var timestamp = new Date().getTime();
            console.log(street);

            if((street !== undefined) &&
                (number !== undefined) &&
                (zipcode !== undefined) &&
                (description !== undefined) &&
                (dateFrom !== undefined) &&
                (dateUntil !== undefined) &&
                (timestamp !== undefined)){

                if(dateFrom <= dateUntil){
                    $scope.error = "";

                    getKeywordsFromDescription(description, function (error, data) {
                        if(!error){
                            description = data;
                            var url = "http://localhost:3000/api/activities/addactivity";

                            /*var file = $scope.myFile; 
                            var uploadUrl = "/images/activities/" + file.name;
                            fileUpload.uploadFileToUrl(file, uploadUrl); 
                            console.log(uploadUrl);*/

                            $http.post(url, {
                             activityName:activityName,
                             street : street,
                             number: number,
                             zipcode: zipcode,
                             description : description,
                             dateFrom : dateFrom,
                             dateUntil : dateUntil,
                             timestamp : timestamp
                             }).success(function (data) {
                             console.log(data);
                                console.log('activity is opgeslaan');
                             $scope.error = data.error;
                             $scope.getActivities();
                             resetForm();
                             //$location.path(data.redirect);
                             });

                        }
                        else{
                            console.log(error);
                        }
                    });


                }
                else if(dateFrom > dateUntil){
                    $scope.error = "ERROR: Date until can't be earlier than date from.";
                }

            }
            else{
                $scope.error = "ERROR: All fields are required.8888";
            }
        };

        $scope.getDetailActivity = function(){
            dbService.getDetailsActivity('activities', $routeParams.activityName).then(function(response){
                $scope.arrDetailsActivity = response.activity;
                initmap();
                return $scope.arrDetailsActivity;


            });
        };

        $scope.interested = function(activityName,interestedUser, createrUser){
            console.log("IK BEN GEÏNTERESSEERD!");
            console.log(activityName);
            console.log(interestedUser);
            console.log(createrUser);
            var url = "";
            var interestedAct = $scope.interestedAct;
            if(interestedAct !== false) {
                console.log(interestedAct);

                url = "http://localhost:3000/api/activities/interested";
                $http.post(url, {
                    activityName: activityName,
                    interestedUser: interestedUser,
                    createrUser: createrUser
                }).success(function (data) {
                    console.log(data);
                    console.log(interestedUser + " is geïnteresseerd in " + activityName + " door " + createrUser);
                    $scope.interestedAct = false;
                    $scope.nameButton = "Not interested";
                    $scope.error = data.error;
                });
            }else{
                console.log(interestedAct);
                url = "http://localhost:3000/api/activities/deleteinterested";
                $http.post(url, {
                    activityName: activityName,
                    interestedUser: interestedUser,
                    createrUser: createrUser
                }).success(function (data) {
                    console.log(data);
                    console.log(interestedUser + " is niet meer geïnteresseerd in " + activityName + " door " + createrUser);
                    $scope.interestedAct = true;
                    $scope.nameButton = "Interested";

                    $scope.error = data.error;
                });
            }
        };

        function recentFirst(a,b) {
            if (a.timestamp > b.timestamp)
                return -1;
            if (a.timestamp < b.timestamp)
                return 1;
            return 0;
        }

        $scope.getMostRecentActivities = function(){
            dbService.getCollection('activities').then(function(response){

                var numberOfActivities = 3;
                var arrTemp = response.activitielist;
                var arrAllActivities = [];

                for (var i = 0, l = arrTemp.length; i < l; i++) {
                    if (new Date(arrTemp[i].untilDate).getTime() > new Date().getTime()) {
                        arrAllActivities.push(arrTemp[i]);
                    }
                }

                arrAllActivities.sort(recentFirst);

                var arrMostRecentActivities = [];

                for(var ii=0; ii<numberOfActivities; ii++){
                    arrMostRecentActivities.push(arrAllActivities[ii]);
                }

                //console.log("[arrAllActivities]: ");
                //console.log(arrAllActivities);
                //console.log("[arrMostRecentActivities]: ");
                //console.log(arrMostRecentActivities);

                $scope.arrMostRecentActivities = arrMostRecentActivities;

            });
        };

        function initmap() {

            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: {lat: 50.8194894, lng: 3.2577076}
            });
            var geocoder = new google.maps.Geocoder();

            geocodeAddress(geocoder, map);


        }

        function geocodeAddress(geocoder, resultsMap) {
            var street = $scope.arrDetailsActivity.street;
            var number = $scope.arrDetailsActivity.number;
            var zipcode = $scope.arrDetailsActivity.zipcode;

            var address = street + " " + number + ", " + zipcode; //hier address uit db instoppen

            geocoder.geocode({'address': address}, function (results, status) {
                if (status === google.maps.GeocoderStatus.OK) {
                    resultsMap.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                    });

                    console.log(marker);

                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }

        function resetForm(){
            var frm = document.getElementsByName('ActivityForm')[0];
            console.log('je komt in de resetform');
            frm.reset();
        }
    };

    angular.module("app").controller("ActivitiesController", ["$scope", "dbService", "$http","$location", "$routeParams","fileUpload", ActivitiesController]);


})();
/**
 * Created by Marthe on 30/12/15.
 */


(function(){
    "use strict";



var locationController = function($scope) {

    console.log('TESTEST');

    $scope.initmap = function() {
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 8,
            center: {lat: 50.8194894, lng: 3.2577076}
        });
        var geocoder = new google.maps.Geocoder();

        geocodeAddress(geocoder, map);

    };

    function geocodeAddress(geocoder, resultsMap) {
        var address = "Graaf Karel de Goedelaan 5, Kortrijk"; //hier address uit db instoppen

        geocoder.geocode({'address': address}, function (results, status) {
            if (status === google.maps.GeocoderStatus.OK) {
                resultsMap.setCenter(results[0].geometry.location);
                var marker = new google.maps.Marker({
                    map: resultsMap,
                    position: results[0].geometry.location
                });

                console.log(marker);

            } else {
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
    }
};

    angular.module("app").controller("locationController", ["$scope", locationController]);
})();
/**
 * Created by Marthe on 15/12/15.
 */
(function(){
    "use strict";
    var selectedInterest = [];

    var loginController = function ($scope, $http, $location) {

        $scope.login = function() {
            $http
                .post('/login', {
                    username: this.username,
                    password: this.password
                })
                .success(function(data) {
                    console.log(data);
                    $scope.error = data.error;
                    $location.path(data.redirect);
                });
        };

        $scope.interests = ['Jazz', 'Hiphop', 'New wave', 'Traveling','Party'];
        $scope.lst = [];
        $scope.change = function(){
            $scope.lst.push('2');
            console.log($scope.lst);
        };
        $scope.stateChanged = function (qId) {
            //if(!$scope.interests[qId]){ //If it is checked
            if(selectedInterest.indexOf(qId) !== -1) {
                //console.log('artNr already exists! DELETE');
                var index = selectedInterest.indexOf(qId);
                if (index > -1) {
                    selectedInterest.splice(index, 1);
                }
            }else{
                selectedInterest.push(qId);
                console.log(selectedInterest);
            }
        };

        $scope.register = function() {
            console.log("REGISTER");


            $http.post('/register', {
                firstname: this.firstname,
                lastname : this.lastname,
                //email : this.email,*/
                username : this.username,
                password : this.password,
                zipcode: this.zipcode,
                birthdate : this.birthdate,
                sex : this.sex,
                biography : this.biography,
                interests:selectedInterest

            }).success(function (data) {
                $scope.error = data.error;
                $location.path(data.redirect);
            });

        };
    };

    var signupController = function ($scope) {
        $scope.categories = [''];
        $scope.newCategory = "";
        $scope.saveCategory = function () {

        };

    };

    var editableCheckboxController = function ($scope) {
        $scope.category = "";
        $scope.showLabel = false;
        $scope.showTextbox = true;
        $scope.saveCategory = function () {
            if ($scope.category) {
                $scope.showLabel = true;
                $scope.showTextbox = false;
            }
            else {
                $scope.showLabel = false;
                $scope.showTextbox = true;
            }
        };
        $scope.edit = function () {
            $scope.showLabel = false;
            $scope.showTextbox = true;
        };
        $scope.isChecked = function(qId){
            console.log(qId);
            if(qId!==  " ") {
                if (selectedInterest.indexOf(qId) !== -1) {
                    var index = selectedInterest.indexOf(qId);
                    if (index > -1) {
                        selectedInterest.splice(index, 1);
                        console.log(selectedInterest);
                    }
                } else {
                    selectedInterest.push(qId);
                    console.log(selectedInterest);
                }
            }
        };
        $scope.stateChanged = function (qId) {

        };

    };

    angular.module("app")
        .controller("loginController", ["$scope", "$http", "$location", loginController])
        .controller("signupController", ["$scope", signupController])
        .controller("editableCheckboxController", ["$scope", editableCheckboxController]);
})();
/**
 * Created by iman on 5/12/15.
 */

(function(){

    "use strict";

    var MatchesController = function($scope, matchesService) {

        $scope.showMatches = function(){

            var nameUser = "Luna";

            var arrMatchesByUser = matchesService.getMatches(nameUser);

            $scope.aantalMatches = arrMatchesByUser.length;

            $scope.arrMatches = arrMatchesByUser;

            var text = "";
            for(var i=0; i<arrMatchesByUser.length; i++){
                text = arrMatchesByUser[i].interests.toString().replace(" ,", " ");
                arrMatchesByUser[i].interests = text;
            }

        };
    };

    angular.module("app").controller("MatchesController", ["$scope", "matchesService", MatchesController]);

})();
/**
 * Created by iman on 20/12/15.
 */


(function(){

    "use strict";

    var ProfilesController = function($scope, $rootScope, $routeParams, dbService) {

        var clicksOnBtn = 0;

        $scope.showDiv = function(){
            $scope.filter = {showFilter:true};
            clicksOnBtn++;

            if(clicksOnBtn > 1){
                $scope.filter = {showFilter:false};
                clicksOnBtn = 0;
            }
        };

        $scope.hideDiv = function(){
            clicksOnBtn = 0;
            $scope.filter = {showFilter:false};
        };

        $scope.showProfiles = function(){

            var username = "";
            if($rootScope.user.username !== undefined){
                username = $rootScope.user.username;
            }

            dbService.getCollection('users').then(function(response){

                var arrProfiles = response.userlist;
                for(var i = 0; i < arrProfiles.length; i++){
                    if(arrProfiles[i].username === username) {
                        arrProfiles.splice(i, 1);
                    }
                }
                for(var ii = 0; ii < arrProfiles.length; ii++){
                    if(arrProfiles[ii].username === "admin") {
                        arrProfiles.splice(ii, 1);
                    }
                }
                $scope.arrProfiles = arrProfiles;

            });

        };

        $scope.sortProperty = "title";
        $scope.filterQuery = "";
        $scope.filterImages = function(i){
            if($scope.filterQuery === ""){
                return true;
            }

            /*
             else if(i.username.toLowerCase().indexOf($scope.filterQuery.toLocaleLowerCase()) >= 0){
             return true;
             }
             */

            else if(i.sex === undefined){
                return false;
            }

            else if($scope.filterQuery.toLowerCase() == i.sex.toLowerCase()){
                return true;
            }

            else if($scope.filterQuery.toLowerCase() === "nofilter"){
                $scope.filterQuery = "";
            }

            return false;
        };
    };

    angular.module("app").controller("ProfilesController", ["$scope", "$rootScope", "$routeParams", "dbService", ProfilesController]);

})();
/**
 * Created by Nikita on 21/12/2015.
 */
(function () {
    "use strict";

    /*var signupController = function ($scope) {
        $scope.categories = [''];
        $scope.newCategory = "";
        $scope.saveCategory = function () {

        };

    };

    var editableCheckboxController = function ($scope) {
        $scope.category = "";
        $scope.showLabel = false;
        $scope.showTextbox = true;
        $scope.saveCategory = function () {
            if ($scope.category) {
                $scope.showLabel = true;
                $scope.showTextbox = false;
            }
            else {
                $scope.showLabel = false;
                $scope.showTextbox = true;
            }
        };
        $scope.edit = function () {
            $scope.showLabel = false;
            $scope.showTextbox = true;
        };

    };
    angular.module("app")
        .controller("signupController", ["$scope", signupController])
        .controller("editableCheckboxController", ["$scope", editableCheckboxController]);*/


})();
/**
 * Created by Marthe on 16/12/15.
 */
(function () {
    "use strict";

    var userController = function ($scope, $rootScope, $http, $location) {
        $http.get('/user').success(function(data) {
            $scope.user = data;
            $rootScope.user = data;

            if(data.username == 'admin'){
                $scope.auth = {isAuth: true, isAdmin : true};
            }
            else if(data.username != 'admin' && data.username !== undefined){
                $scope.auth = {isAuth: true, isAdmin : false};
            }
            else if(data.username === undefined){
                $scope.auth = {isAuth: false, isAdmin : false};

            }


        });


        /*$scope.logout = function() {
            $http.get('/logout').success(function (data) {
                $location.path(data.redirect);
            });
        };*/
    };


    angular.module("app").controller("userController", ["$scope", "$rootScope", "$http", "$location", userController]);
})();
/**
 * Created by iman on 20/12/15.
 */
(function(){

    "use strict";

    var UsersController = function($scope, $routeParams, dbService) {

        $scope.getUsers = function(){

            dbService.getCollection('users').then(function(response){

                //console.log(response);
                $scope.arrUsers = response.userlist;

            });

        };

        $scope.getDetailUser = function(){

            dbService.getDetailsUser('users', $routeParams.username).then(function(response){
                $scope.arrDetails = response.activity;
            });
        };

        $scope.getUserByID = function(){

            dbService.getItem('user').then(function(response){

                console.log(response);
                $scope.userProfile = response;

            });

        };


    };

    angular.module("app").controller("UsersController", ["$scope", "$routeParams", "dbService", UsersController]);

})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIkFjdGl2aXR5LmpzIiwiYWN0aXZpdGllc1NlcnZpY2UuanMiLCJkYlNlcnZpY2UuanMiLCJtYXRjaGVzU2VydmljZS5qcyIsIkFjdGl2aXRpZXNDb250cm9sbGVyLmpzIiwibG9jYXRpb25Db250cm9sbGVyLmpzIiwibG9naW5Db250cm9sbGVyLmpzIiwiTWF0Y2hlc0NvbnRyb2xsZXIuanMiLCJQcm9maWxlc0NvbnRyb2xsZXIuanMiLCJzaWdudXBDb250cm9sbGVyLmpzIiwidXNlckNvbnRyb2xsZXIuanMiLCJVc2Vyc0NvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBNYXJ0aGUgb24gMTAvMTIvMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoXCJhcHBcIiwgW1wibmdSb3V0ZVwiXSk7XHJcbiAgICBhcHAuY29uZmlnKGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKXtcclxuICAgICAgICAkcm91dGVQcm92aWRlclxyXG4gICAgICAgICAgICAud2hlbihcIi9cIix7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL2hvbWUuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKFwiL3NpZ251cFwiLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL3NpZ251cC5odG1sXCJcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oXCIvaG9tZVwiLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vdmlld3MvaG9tZS5odG1sXCJcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oXCIvbWF0Y2hlc1wiLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vdmlld3MvbWF0Y2hlcy5odG1sXCJcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oXCIvaG93dG9cIix7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL2hvd1RvLmh0bWxcIlxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbihcIi9hY3Rpdml0aWVzXCIse1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9hY3Rpdml0aWVzLmh0bWxcIlxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbihcIi9hZG1pblwiLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vdmlld3MvYWRtaW4uaHRtbFwiXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKFwiL3NlYXJjaHByb2ZpbGVzXCIse1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9zZWFyY2hQcm9maWxlcy5odG1sXCJcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oXCIvbXlwcm9maWxlXCIse1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi92aWV3cy9teVByb2ZpbGUuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKFwiL3VzZXJkZXRhaWxzLzp1c2VybmFtZVwiLHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vdmlld3MvZGV0YWlsc1VzZXIuaHRtbFwiLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1VzZXJzQ29udHJvbGxlcidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oXCIvZGV0YWlsc3VzZXJcIix7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL2RldGFpbHNVc2VyLmh0bWxcIlxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbihcIi9hY3Rpdml0eWRldGFpbHMvOmFjdGl2aXR5TmFtZVwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL3ZpZXdzL2RldGFpbHNBY3Rpdml0eS5odG1sXCIsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkFjdGl2aXRpZXNDb250cm9sbGVyXCJcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICB9KTtcclxuXHJcbiAgICBhcHAucnVuKGZ1bmN0aW9uICgkcm9vdFNjb3BlKSB7XHJcbiAgICAgICAgJHJvb3RTY29wZS51c2VyID0ge307XHJcbiAgICB9KTtcclxuXHJcbiAgICBhcHAuZGlyZWN0aXZlKCduZ0VudGVyJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuYmluZChcImtleWRvd24ga2V5cHJlc3NcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMubmdFbnRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgYXBwLmRpcmVjdGl2ZSgnZmlsZU1vZGVsJywgWyckcGFyc2UnLCBmdW5jdGlvbiAoJHBhcnNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSAkcGFyc2UoYXR0cnMuZmlsZU1vZGVsKTtcclxuICAgICAgICAgICAgICAgIHZhciBtb2RlbFNldHRlciA9IG1vZGVsLmFzc2lnbjtcclxuXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmJpbmQoJ2NoYW5nZScsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsU2V0dGVyKHNjb3BlLCBlbGVtZW50WzBdLmZpbGVzWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcclxuXHJcbiAgICBhcHAuc2VydmljZSgnZmlsZVVwbG9hZCcsIFsnJGh0dHAnLCBmdW5jdGlvbiAoJGh0dHApIHtcclxuICAgICAgICB0aGlzLnVwbG9hZEZpbGVUb1VybCA9IGZ1bmN0aW9uKGZpbGUsIHVwbG9hZFVybCl7XHJcbiAgICAgICAgICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgICAgICBmZC5hcHBlbmQoJ2ZpbGUnLCBmaWxlKTtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCh1cGxvYWRVcmwsIGZkLCB7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1SZXF1ZXN0OiBhbmd1bGFyLmlkZW50aXR5LFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiB1bmRlZmluZWR9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic3VjY2Vzc1wiKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcclxuXHJcblxyXG4gICAgYXBwLmRpcmVjdGl2ZSgnZWRpdGFibGVDaGVja2JveCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4vdmlld3MvZWRpdGFibGVjaGVja2JveC5odG1sJ1xyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcblxyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gMTUvMTIvMTUuXHJcbiAqL1xyXG52YXIgQWN0aXZpdHkgPSBmdW5jdGlvbihpbWcsIG5hbWUsIHBsYWNlLCBrZXl3b3JkcywgcGFydGljaXBhbnRzLCBteUV2ZW50KXtcclxuICAgIHRoaXMuaW1nID0gaW1nO1xyXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgIHRoaXMucGxhY2UgPSBwbGFjZTtcclxuICAgIHRoaXMua2V5d29yZHMgPSBrZXl3b3JkcztcclxuICAgIHRoaXMucGFydGljaXBhbnRzID0gcGFydGljaXBhbnRzO1xyXG4gICAgdGhpcy5teUV2ZW50ID0gbXlFdmVudDtcclxufTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBpbWFuIG9uIDUvMTIvMTUuXHJcbiAqL1xyXG4vKihmdW5jdGlvbigpe1xyXG5cclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBhY3Rpdml0aWVzU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgdmFyIGdldEFjdGl2aXRpZXMgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgbG9jYWxVcmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9kYXRhL2FjdGl2aXRpZXMuanNvblwiO1xyXG4gICAgICAgICAgICB2YXIgeG1sSHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgICAgICB4bWxIdHRwLm9wZW4oXCJHRVRcIiwgbG9jYWxVcmwsIGZhbHNlKTtcclxuICAgICAgICAgICAgeG1sSHR0cC5zZW5kKG51bGwpO1xyXG5cclxuICAgICAgICAgICAgaWYoeG1sSHR0cC5zdGF0dXMgPT0gMjAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHhtbEh0dHAucmVzcG9uc2VUZXh0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhcnJBY3Rpdml0aWVzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gZGF0YVtpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0FjdGl2aXR5ID0gbmV3IEFjdGl2aXR5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkuaW1nID0gZC5pbWc7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkubmFtZSA9IGQubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBuZXdBY3Rpdml0eS5wbGFjZSA9IGQucGxhY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkucGFydGljaXBhbnRzID0gZC5wYXJ0aWNpcGFudHM7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZpdHkubXlFdmVudCA9IGQubXlFdmVudDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGlpPTA7IGlpPCBkLmtleXdvcmRzLmxlbmd0aDsgaWkrKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlpID09IGQua2V5d29yZHMubGVuZ3RoLTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCArPSBkLmtleXdvcmRzW2lpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCArPSBkLmtleXdvcmRzW2lpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gXCIsIFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBuZXdBY3Rpdml0eS5rZXl3b3JkcyA9IHRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyQWN0aXZpdGllcy5wdXNoKG5ld0FjdGl2aXR5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyQWN0aXZpdGllcztcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9wdWJsaWMgZ2VkZWVsdGVcclxuICAgICAgICByZXR1cm57XHJcblxyXG4gICAgICAgICAgICBnZXRBY3Rpdml0aWVzOmdldEFjdGl2aXRpZXNcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmZhY3RvcnkoXCJhY3Rpdml0aWVzU2VydmljZVwiLCBbYWN0aXZpdGllc1NlcnZpY2VdKTtcclxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF4gZGV6ZSBuYWFtIGJlcGFhbHQgd2Vsa2UgbmFhbSBqZSBub2RpZyBoZWJ0IGluIGplIGNvbnRyb2xsZXIgYWxzIHZlcndpanppbmchXHJcblxyXG59KSgpOyovIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgaW1hbiBvbiAxNS8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuXHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgZGJTZXJ2aWNlID0gZnVuY3Rpb24gKCRodHRwKSB7XHJcblxyXG4gICAgICAgIHZhciBnZXRDb2xsZWN0aW9uID0gZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcclxuXHJcblxyXG4gICAgICAgICAgICB2YXIgdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL1wiICsgY29sbGVjdGlvbjtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEJ5SUQgPSBmdW5jdGlvbiAoY29sbGVjdGlvbiwgaWQpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9cIiArIGNvbGxlY3Rpb24gKyBcIi9cIiArIGlkO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RGV0YWlsc1VzZXIgPSBmdW5jdGlvbiAoY29sbGVjdGlvbiwgdXNlcm5hbWUpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9cIiArIGNvbGxlY3Rpb24gKyBcIi91c2VyZGV0YWlsL1wiICsgdXNlcm5hbWU7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRJdGVtID0gZnVuY3Rpb24oaXRlbSl7XHJcblxyXG4gICAgICAgICAgICB2YXIgdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL1wiICsgaXRlbTtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL3VzZXInKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RGV0YWlsc0FjdGl2aXR5ID0gZnVuY3Rpb24gKGNvbGxlY3Rpb24sIGFjdGl2aXR5bmFtZSkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL1wiICsgY29sbGVjdGlvbiArIFwiL2FjdGl2aXR5ZGV0YWlsL1wiICsgYWN0aXZpdHluYW1lO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Tm9pc2VXb3JkcyA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9kYXRhL25vaXNld29yZHMuanNvblwiO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIC8vcHVibGljIGdlZGVlbHRlXHJcbiAgICAgICAgcmV0dXJue1xyXG5cclxuICAgICAgICAgICAgZ2V0Q29sbGVjdGlvbjpnZXRDb2xsZWN0aW9uLFxyXG4gICAgICAgICAgICBnZXRCeUlEOmdldEJ5SUQsXHJcbiAgICAgICAgICAgIGdldEl0ZW06Z2V0SXRlbSxcclxuICAgICAgICAgICAgZ2V0RGV0YWlsc1VzZXI6IGdldERldGFpbHNVc2VyLFxyXG4gICAgICAgICAgICBnZXREZXRhaWxzQWN0aXZpdHk6IGdldERldGFpbHNBY3Rpdml0eSxcclxuICAgICAgICAgICAgZ2V0Tm9pc2VXb3JkczogZ2V0Tm9pc2VXb3Jkc1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuZmFjdG9yeShcImRiU2VydmljZVwiLCBbXCIkaHR0cFwiLCBkYlNlcnZpY2VdKTtcclxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF4gZGV6ZSBuYWFtIGJlcGFhbHQgd2Vsa2UgbmFhbSBqZSBub2RpZyBoZWJ0IGluIGplIGNvbnRyb2xsZXIgYWxzIHZlcndpanppbmchXHJcblxyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gNS8xMi8xNS5cclxuICovXHJcbihmdW5jdGlvbigpe1xyXG5cclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBtYXRjaGVzU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgdmFyIGdldE1hdGNoZXMgPSBmdW5jdGlvbiAobmFtZVVzZXIpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB2YXJpYWJlbFVSTCA9IFwidG9nZXRoZXJcIjtcclxuICAgICAgICAgICAgdmFyIGxvY2FsVXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvZGF0YS9tYXRjaGVzLmpzb25cIjtcclxuICAgICAgICAgICAgdmFyIHhtbEh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgICAgICAgICAgeG1sSHR0cC5vcGVuKFwiR0VUXCIsIGxvY2FsVXJsLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHhtbEh0dHAuc2VuZChudWxsKTtcclxuXHJcbiAgICAgICAgICAgIGlmKHhtbEh0dHAuc3RhdHVzID09IDIwMCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZSh4bWxIdHRwLnJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJyID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJyTWF0Y2hlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyck1hdGNoVXNlcnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIHZhciBhcnJNYXRjaEludGVyZXN0cyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpIDwgZGF0YS5sZW5ndGg7IGkrKyl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlclwiOiBkYXRhW2ldLnVzZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibWF0Y2hlc1wiOmRhdGFbaV0ubWF0Y2hlc1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGFyci5wdXNoKG9iaik7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaWkgPSAwOyBpaTxhcnIubGVuZ3RoOyBpaSsrKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gYXJyW2lpXS51c2VyLmluZGV4T2YobmFtZVVzZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGluZGV4ID09PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyTWF0Y2hlcy5wdXNoKGFycltpaV0ubWF0Y2hlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJJbmRleDogXCIraW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYXJyKTtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYXJyTWF0Y2hlc1swXSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhcnJNYXRjaGVzQnlVc2VyID0gYXJyTWF0Y2hlc1swXTtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJBYW50YWwgbWF0Y2hlczogXCIgKyBhcnJNYXRjaGVzQnlVc2VyLmxlbmd0aCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFyck1hdGNoZXNCeVVzZXI7XHJcblxyXG4gICAgICAgICAgICAgICAgLypcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaWlpID0gMDsgaWlpPGFyck1hdGNoZXNbMF0ubGVuZ3RoOyBpaWkrKyl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXRjaFVzZXIgPSBhcnJNYXRjaGVzWzBdW2lpaV0udXNlcjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hJbnRlcmVzdHMgPSBhcnJNYXRjaGVzWzBdW2lpaV0uaW50ZXJlc3RzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhcnJNYXRjaFVzZXJzLnB1c2gobWF0Y2hVc2VyKTtcclxuICAgICAgICAgICAgICAgICAgICBhcnJNYXRjaEludGVyZXN0cy5wdXNoKG1hdGNoSW50ZXJlc3RzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhtYXRjaFVzZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cobWF0Y2hJbnRlcmVzdHMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyck1hdGNoVXNlcnMpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJyTWF0Y2hJbnRlcmVzdHMpO1xyXG4gICAgICAgICAgICAgICAgKi9cclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL3B1YmxpYyBnZWRlZWx0ZVxyXG4gICAgICAgIHJldHVybntcclxuXHJcbiAgICAgICAgICAgIGdldE1hdGNoZXM6Z2V0TWF0Y2hlcyxcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmZhY3RvcnkoXCJtYXRjaGVzU2VydmljZVwiLCBbbWF0Y2hlc1NlcnZpY2VdKTtcclxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF4gZGV6ZSBuYWFtIGJlcGFhbHQgd2Vsa2UgbmFhbSBqZSBub2RpZyBoZWJ0IGluIGplIGNvbnRyb2xsZXIgYWxzIHZlcndpanppbmchXHJcblxyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGltYW4gb24gNS8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICB2YXIgQWN0aXZpdGllc0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCBkYlNlcnZpY2UsICRodHRwLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgJHJvdXRlKSB7XHJcbiAgICAgICAgJHNjb3BlLmludGVyZXN0ZWRBY3Q9dHJ1ZTtcclxuICAgICAgICAkc2NvcGUubmFtZUJ1dHRvbiA9IFwiSW50ZXJlc3RlZFwiO1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0QWN0aXZpdGllcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZGJTZXJ2aWNlLmdldENvbGxlY3Rpb24oJ2FjdGl2aXRpZXMnKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhcnJUZW1wID0gcmVzcG9uc2UuYWN0aXZpdGllbGlzdDtcclxuICAgICAgICAgICAgICAgIHZhciBhcnJBY3RzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBhcnJUZW1wLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXcgRGF0ZShhcnJUZW1wW2ldLnVudGlsRGF0ZSkuZ2V0VGltZSgpID49IG5ldyBEYXRlKCkuZ2V0VGltZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyckFjdHMucHVzaChhcnJUZW1wW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFyckFjdGl2aXRpZXMgPSBhcnJBY3RzO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBTdHJpbmcucHJvdG90eXBlLnJlcGxhY2VBbGwgPSBmdW5jdGlvbiggdG9rZW4sIG5ld1Rva2VuLCBpZ25vcmVDYXNlICkge1xyXG4gICAgICAgICAgICB2YXIgX3Rva2VuO1xyXG4gICAgICAgICAgICB2YXIgc3RyID0gdGhpcyArIFwiXCI7XHJcbiAgICAgICAgICAgIHZhciBpID0gLTE7XHJcblxyXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiB0b2tlbiA9PT0gXCJzdHJpbmdcIiApIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIGlnbm9yZUNhc2UgKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIF90b2tlbiA9IHRva2VuLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlKCAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBzdHIudG9Mb3dlckNhc2UoKS5pbmRleE9mKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4sIGkgPj0gMCA/IGkgKyBuZXdUb2tlbi5sZW5ndGggOiAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICkgKSAhPT0gLTFcclxuICAgICAgICAgICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoIDAsIGkgKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdUb2tlbiArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIuc3Vic3RyaW5nKCBpICsgdG9rZW4ubGVuZ3RoICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3BsaXQoIHRva2VuICkuam9pbiggbmV3VG9rZW4gKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHN0cjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0luQXJyYXkodmFsdWUsIGFycmF5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhcnJheS5pbmRleE9mKHZhbHVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEtleXdvcmRzRnJvbURlc2NyaXB0aW9uKGRlc2NyaXB0aW9uLCBjYWxsYmFjaykge1xyXG5cclxuICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbi5yZXBsYWNlQWxsKCcuJywgJycpO1xyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uLnJlcGxhY2VBbGwoJywnLCAnJyk7XHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb24ucmVwbGFjZUFsbCgnPycsICcnKTtcclxuICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbi5yZXBsYWNlQWxsKCchJywgJycpO1xyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uLnJlcGxhY2VBbGwoJ1wiJywgJycpO1xyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uLnJlcGxhY2VBbGwoXCInXCIsICcnKTtcclxuXHJcbiAgICAgICAgICAgIHZhciB3b3JkcyA9IGRlc2NyaXB0aW9uLnNwbGl0KFwiIFwiKTtcclxuICAgICAgICAgICAgdmFyIGtleVdvcmRzID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgIGRiU2VydmljZS5nZXROb2lzZVdvcmRzKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBub2lzZVdvcmRzID0gcmVzcG9uc2Uubm9pc2V3b3JkcztcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdvcmRzLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0luQXJyYXkod29yZHNbaV0udG9Mb3dlckNhc2UoKSwgbm9pc2VXb3JkcykgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAga2V5V29yZHMgKz0gd29yZHNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleVdvcmRzICs9IFwiIFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL3JldHVybiBrZXlXb3JkcztcclxuICAgICAgICAgICAgICAgIGlmKCFrZXlXb3Jkcy5pc0VtcHR5KXtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBrZXlXb3Jkcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhcIk5vIGtleXdvcmRzIGZvdW5kLlwiLCBudWxsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLmFkZEFjdGl2aXR5ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQUREIEFDVElWSVRZXCIpO1xyXG4gICAgICAgICAgICB2YXIgYWN0aXZpdHlOYW1lID0gdGhpcy5hY3Rpdml0eU5hbWU7XHJcbiAgICAgICAgICAgIHZhciBzdHJlZXQgPSB0aGlzLnN0cmVldDtcclxuICAgICAgICAgICAgdmFyIG51bWJlciA9IHRoaXMubnVtYmVyO1xyXG4gICAgICAgICAgICB2YXIgemlwY29kZSA9IHRoaXMuemlwY29kZTtcclxuICAgICAgICAgICAgdmFyIGRlc2NyaXB0aW9uID0gdGhpcy5jb21tZW50O1xyXG4gICAgICAgICAgICB2YXIgZGF0ZUZyb20gPSB0aGlzLmRhdGVGcm9tO1xyXG4gICAgICAgICAgICB2YXIgZGF0ZVVudGlsID0gdGhpcy5kYXRlVW50aWw7XHJcbiAgICAgICAgICAgIHZhciB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coc3RyZWV0KTtcclxuXHJcbiAgICAgICAgICAgIGlmKChzdHJlZXQgIT09IHVuZGVmaW5lZCkgJiZcclxuICAgICAgICAgICAgICAgIChudW1iZXIgIT09IHVuZGVmaW5lZCkgJiZcclxuICAgICAgICAgICAgICAgICh6aXBjb2RlICE9PSB1bmRlZmluZWQpICYmXHJcbiAgICAgICAgICAgICAgICAoZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkgJiZcclxuICAgICAgICAgICAgICAgIChkYXRlRnJvbSAhPT0gdW5kZWZpbmVkKSAmJlxyXG4gICAgICAgICAgICAgICAgKGRhdGVVbnRpbCAhPT0gdW5kZWZpbmVkKSAmJlxyXG4gICAgICAgICAgICAgICAgKHRpbWVzdGFtcCAhPT0gdW5kZWZpbmVkKSl7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoZGF0ZUZyb20gPD0gZGF0ZVVudGlsKXtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnZXRLZXl3b3Jkc0Zyb21EZXNjcmlwdGlvbihkZXNjcmlwdGlvbiwgZnVuY3Rpb24gKGVycm9yLCBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFlcnJvcil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL2FjdGl2aXRpZXMvYWRkYWN0aXZpdHlcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKnZhciBmaWxlID0gJHNjb3BlLm15RmlsZTvigKhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cGxvYWRVcmwgPSBcIi9pbWFnZXMvYWN0aXZpdGllcy9cIiArIGZpbGUubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVVcGxvYWQudXBsb2FkRmlsZVRvVXJsKGZpbGUsIHVwbG9hZFVybCk74oCoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh1cGxvYWRVcmwpOyovXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGh0dHAucG9zdCh1cmwsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eU5hbWU6YWN0aXZpdHlOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVldCA6IHN0cmVldCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IG51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6aXBjb2RlOiB6aXBjb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uIDogZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUZyb20gOiBkYXRlRnJvbSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlVW50aWwgOiBkYXRlVW50aWwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wIDogdGltZXN0YW1wXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhY3Rpdml0eSBpcyBvcGdlc2xhYW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5nZXRBY3Rpdml0aWVzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXRGb3JtKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kbG9jYXRpb24ucGF0aChkYXRhLnJlZGlyZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmKGRhdGVGcm9tID4gZGF0ZVVudGlsKXtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIkVSUk9SOiBEYXRlIHVudGlsIGNhbid0IGJlIGVhcmxpZXIgdGhhbiBkYXRlIGZyb20uXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIkVSUk9SOiBBbGwgZmllbGRzIGFyZSByZXF1aXJlZC44ODg4XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0RGV0YWlsQWN0aXZpdHkgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBkYlNlcnZpY2UuZ2V0RGV0YWlsc0FjdGl2aXR5KCdhY3Rpdml0aWVzJywgJHJvdXRlUGFyYW1zLmFjdGl2aXR5TmFtZSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXJyRGV0YWlsc0FjdGl2aXR5ID0gcmVzcG9uc2UuYWN0aXZpdHk7XHJcbiAgICAgICAgICAgICAgICBpbml0bWFwKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmFyckRldGFpbHNBY3Rpdml0eTtcclxuXHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuaW50ZXJlc3RlZCA9IGZ1bmN0aW9uKGFjdGl2aXR5TmFtZSxpbnRlcmVzdGVkVXNlciwgY3JlYXRlclVzZXIpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIklLIEJFTiBHRcOPTlRFUkVTU0VFUkQhXCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhY3Rpdml0eU5hbWUpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhpbnRlcmVzdGVkVXNlcik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGNyZWF0ZXJVc2VyKTtcclxuICAgICAgICAgICAgdmFyIHVybCA9IFwiXCI7XHJcbiAgICAgICAgICAgIHZhciBpbnRlcmVzdGVkQWN0ID0gJHNjb3BlLmludGVyZXN0ZWRBY3Q7XHJcbiAgICAgICAgICAgIGlmKGludGVyZXN0ZWRBY3QgIT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhpbnRlcmVzdGVkQWN0KTtcclxuXHJcbiAgICAgICAgICAgICAgICB1cmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvYWN0aXZpdGllcy9pbnRlcmVzdGVkXCI7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwge1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5TmFtZTogYWN0aXZpdHlOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGludGVyZXN0ZWRVc2VyOiBpbnRlcmVzdGVkVXNlcixcclxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVyVXNlcjogY3JlYXRlclVzZXJcclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhpbnRlcmVzdGVkVXNlciArIFwiIGlzIGdlw69udGVyZXNzZWVyZCBpbiBcIiArIGFjdGl2aXR5TmFtZSArIFwiIGRvb3IgXCIgKyBjcmVhdGVyVXNlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmludGVyZXN0ZWRBY3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubmFtZUJ1dHRvbiA9IFwiTm90IGludGVyZXN0ZWRcIjtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaW50ZXJlc3RlZEFjdCk7XHJcbiAgICAgICAgICAgICAgICB1cmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvYWN0aXZpdGllcy9kZWxldGVpbnRlcmVzdGVkXCI7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwge1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5TmFtZTogYWN0aXZpdHlOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGludGVyZXN0ZWRVc2VyOiBpbnRlcmVzdGVkVXNlcixcclxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVyVXNlcjogY3JlYXRlclVzZXJcclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhpbnRlcmVzdGVkVXNlciArIFwiIGlzIG5pZXQgbWVlciBnZcOvbnRlcmVzc2VlcmQgaW4gXCIgKyBhY3Rpdml0eU5hbWUgKyBcIiBkb29yIFwiICsgY3JlYXRlclVzZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pbnRlcmVzdGVkQWN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubmFtZUJ1dHRvbiA9IFwiSW50ZXJlc3RlZFwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiByZWNlbnRGaXJzdChhLGIpIHtcclxuICAgICAgICAgICAgaWYgKGEudGltZXN0YW1wID4gYi50aW1lc3RhbXApXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgIGlmIChhLnRpbWVzdGFtcCA8IGIudGltZXN0YW1wKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLmdldE1vc3RSZWNlbnRBY3Rpdml0aWVzID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgZGJTZXJ2aWNlLmdldENvbGxlY3Rpb24oJ2FjdGl2aXRpZXMnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbnVtYmVyT2ZBY3Rpdml0aWVzID0gMztcclxuICAgICAgICAgICAgICAgIHZhciBhcnJUZW1wID0gcmVzcG9uc2UuYWN0aXZpdGllbGlzdDtcclxuICAgICAgICAgICAgICAgIHZhciBhcnJBbGxBY3Rpdml0aWVzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBhcnJUZW1wLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXcgRGF0ZShhcnJUZW1wW2ldLnVudGlsRGF0ZSkuZ2V0VGltZSgpID4gbmV3IERhdGUoKS5nZXRUaW1lKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyQWxsQWN0aXZpdGllcy5wdXNoKGFyclRlbXBbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBhcnJBbGxBY3Rpdml0aWVzLnNvcnQocmVjZW50Rmlyc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhcnJNb3N0UmVjZW50QWN0aXZpdGllcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaWk9MDsgaWk8bnVtYmVyT2ZBY3Rpdml0aWVzOyBpaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICBhcnJNb3N0UmVjZW50QWN0aXZpdGllcy5wdXNoKGFyckFsbEFjdGl2aXRpZXNbaWldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiW2FyckFsbEFjdGl2aXRpZXNdOiBcIik7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGFyckFsbEFjdGl2aXRpZXMpO1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIlthcnJNb3N0UmVjZW50QWN0aXZpdGllc106IFwiKTtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYXJyTW9zdFJlY2VudEFjdGl2aXRpZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5hcnJNb3N0UmVjZW50QWN0aXZpdGllcyA9IGFyck1vc3RSZWNlbnRBY3Rpdml0aWVzO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5pdG1hcCgpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgICAgICAgICAgem9vbTogMTIsXHJcbiAgICAgICAgICAgICAgICBjZW50ZXI6IHtsYXQ6IDUwLjgxOTQ4OTQsIGxuZzogMy4yNTc3MDc2fVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdmFyIGdlb2NvZGVyID0gbmV3IGdvb2dsZS5tYXBzLkdlb2NvZGVyKCk7XHJcblxyXG4gICAgICAgICAgICBnZW9jb2RlQWRkcmVzcyhnZW9jb2RlciwgbWFwKTtcclxuXHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2VvY29kZUFkZHJlc3MoZ2VvY29kZXIsIHJlc3VsdHNNYXApIHtcclxuICAgICAgICAgICAgdmFyIHN0cmVldCA9ICRzY29wZS5hcnJEZXRhaWxzQWN0aXZpdHkuc3RyZWV0O1xyXG4gICAgICAgICAgICB2YXIgbnVtYmVyID0gJHNjb3BlLmFyckRldGFpbHNBY3Rpdml0eS5udW1iZXI7XHJcbiAgICAgICAgICAgIHZhciB6aXBjb2RlID0gJHNjb3BlLmFyckRldGFpbHNBY3Rpdml0eS56aXBjb2RlO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFkZHJlc3MgPSBzdHJlZXQgKyBcIiBcIiArIG51bWJlciArIFwiLCBcIiArIHppcGNvZGU7IC8vaGllciBhZGRyZXNzIHVpdCBkYiBpbnN0b3BwZW5cclxuXHJcbiAgICAgICAgICAgIGdlb2NvZGVyLmdlb2NvZGUoeydhZGRyZXNzJzogYWRkcmVzc30sIGZ1bmN0aW9uIChyZXN1bHRzLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLk9LKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0c01hcC5zZXRDZW50ZXIocmVzdWx0c1swXS5nZW9tZXRyeS5sb2NhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXA6IHJlc3VsdHNNYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiByZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1hcmtlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBhbGVydCgnR2VvY29kZSB3YXMgbm90IHN1Y2Nlc3NmdWwgZm9yIHRoZSBmb2xsb3dpbmcgcmVhc29uOiAnICsgc3RhdHVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNldEZvcm0oKXtcclxuICAgICAgICAgICAgdmFyIGZybSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCdBY3Rpdml0eUZvcm0nKVswXTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2plIGtvbXQgaW4gZGUgcmVzZXRmb3JtJyk7XHJcbiAgICAgICAgICAgIGZybS5yZXNldCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcIkFjdGl2aXRpZXNDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcImRiU2VydmljZVwiLCBcIiRodHRwXCIsXCIkbG9jYXRpb25cIiwgXCIkcm91dGVQYXJhbXNcIixcImZpbGVVcGxvYWRcIiwgQWN0aXZpdGllc0NvbnRyb2xsZXJdKTtcclxuXHJcblxyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1hcnRoZSBvbiAzMC8xMi8xNS5cclxuICovXHJcblxyXG5cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcblxyXG5cclxudmFyIGxvY2F0aW9uQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSkge1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdURVNURVNUJyk7XHJcblxyXG4gICAgJHNjb3BlLmluaXRtYXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgICAgICAgICAgem9vbTogOCxcclxuICAgICAgICAgICAgY2VudGVyOiB7bGF0OiA1MC44MTk0ODk0LCBsbmc6IDMuMjU3NzA3Nn1cclxuICAgICAgICB9KTtcclxuICAgICAgICB2YXIgZ2VvY29kZXIgPSBuZXcgZ29vZ2xlLm1hcHMuR2VvY29kZXIoKTtcclxuXHJcbiAgICAgICAgZ2VvY29kZUFkZHJlc3MoZ2VvY29kZXIsIG1hcCk7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZW9jb2RlQWRkcmVzcyhnZW9jb2RlciwgcmVzdWx0c01hcCkge1xyXG4gICAgICAgIHZhciBhZGRyZXNzID0gXCJHcmFhZiBLYXJlbCBkZSBHb2VkZWxhYW4gNSwgS29ydHJpamtcIjsgLy9oaWVyIGFkZHJlc3MgdWl0IGRiIGluc3RvcHBlblxyXG5cclxuICAgICAgICBnZW9jb2Rlci5nZW9jb2RlKHsnYWRkcmVzcyc6IGFkZHJlc3N9LCBmdW5jdGlvbiAocmVzdWx0cywgc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLk9LKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRzTWFwLnNldENlbnRlcihyZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uKTtcclxuICAgICAgICAgICAgICAgIHZhciBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICBtYXA6IHJlc3VsdHNNYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHJlc3VsdHNbMF0uZ2VvbWV0cnkubG9jYXRpb25cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1hcmtlcik7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoJ0dlb2NvZGUgd2FzIG5vdCBzdWNjZXNzZnVsIGZvciB0aGUgZm9sbG93aW5nIHJlYXNvbjogJyArIHN0YXR1cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwibG9jYXRpb25Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBsb2NhdGlvbkNvbnRyb2xsZXJdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBNYXJ0aGUgb24gMTUvMTIvMTUuXHJcbiAqL1xyXG4oZnVuY3Rpb24oKXtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgdmFyIHNlbGVjdGVkSW50ZXJlc3QgPSBbXTtcclxuXHJcbiAgICB2YXIgbG9naW5Db250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikge1xyXG5cclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJGh0dHBcclxuICAgICAgICAgICAgICAgIC5wb3N0KCcvbG9naW4nLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMucGFzc3dvcmRcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gZGF0YS5lcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChkYXRhLnJlZGlyZWN0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5pbnRlcmVzdHMgPSBbJ0phenonLCAnSGlwaG9wJywgJ05ldyB3YXZlJywgJ1RyYXZlbGluZycsJ1BhcnR5J107XHJcbiAgICAgICAgJHNjb3BlLmxzdCA9IFtdO1xyXG4gICAgICAgICRzY29wZS5jaGFuZ2UgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAkc2NvcGUubHN0LnB1c2goJzInKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLmxzdCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuc3RhdGVDaGFuZ2VkID0gZnVuY3Rpb24gKHFJZCkge1xyXG4gICAgICAgICAgICAvL2lmKCEkc2NvcGUuaW50ZXJlc3RzW3FJZF0peyAvL0lmIGl0IGlzIGNoZWNrZWRcclxuICAgICAgICAgICAgaWYoc2VsZWN0ZWRJbnRlcmVzdC5pbmRleE9mKHFJZCkgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdhcnROciBhbHJlYWR5IGV4aXN0cyEgREVMRVRFJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBzZWxlY3RlZEludGVyZXN0LmluZGV4T2YocUlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJbnRlcmVzdC5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkSW50ZXJlc3QucHVzaChxSWQpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRJbnRlcmVzdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJSRUdJU1RFUlwiKTtcclxuXHJcblxyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCcvcmVnaXN0ZXInLCB7XHJcbiAgICAgICAgICAgICAgICBmaXJzdG5hbWU6IHRoaXMuZmlyc3RuYW1lLFxyXG4gICAgICAgICAgICAgICAgbGFzdG5hbWUgOiB0aGlzLmxhc3RuYW1lLFxyXG4gICAgICAgICAgICAgICAgLy9lbWFpbCA6IHRoaXMuZW1haWwsKi9cclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lIDogdGhpcy51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkIDogdGhpcy5wYXNzd29yZCxcclxuICAgICAgICAgICAgICAgIHppcGNvZGU6IHRoaXMuemlwY29kZSxcclxuICAgICAgICAgICAgICAgIGJpcnRoZGF0ZSA6IHRoaXMuYmlydGhkYXRlLFxyXG4gICAgICAgICAgICAgICAgc2V4IDogdGhpcy5zZXgsXHJcbiAgICAgICAgICAgICAgICBiaW9ncmFwaHkgOiB0aGlzLmJpb2dyYXBoeSxcclxuICAgICAgICAgICAgICAgIGludGVyZXN0czpzZWxlY3RlZEludGVyZXN0XHJcblxyXG4gICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgc2lnbnVwQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcclxuICAgICAgICAkc2NvcGUuY2F0ZWdvcmllcyA9IFsnJ107XHJcbiAgICAgICAgJHNjb3BlLm5ld0NhdGVnb3J5ID0gXCJcIjtcclxuICAgICAgICAkc2NvcGUuc2F2ZUNhdGVnb3J5ID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgdmFyIGVkaXRhYmxlQ2hlY2tib3hDb250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSkge1xyXG4gICAgICAgICRzY29wZS5jYXRlZ29yeSA9IFwiXCI7XHJcbiAgICAgICAgJHNjb3BlLnNob3dMYWJlbCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5zaG93VGV4dGJveCA9IHRydWU7XHJcbiAgICAgICAgJHNjb3BlLnNhdmVDYXRlZ29yeSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5jYXRlZ29yeSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dMYWJlbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93TGFiZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93VGV4dGJveCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5lZGl0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0xhYmVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5zaG93VGV4dGJveCA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuaXNDaGVja2VkID0gZnVuY3Rpb24ocUlkKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocUlkKTtcclxuICAgICAgICAgICAgaWYocUlkIT09ICBcIiBcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkSW50ZXJlc3QuaW5kZXhPZihxSWQpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IHNlbGVjdGVkSW50ZXJlc3QuaW5kZXhPZihxSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSW50ZXJlc3Quc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRJbnRlcmVzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEludGVyZXN0LnB1c2gocUlkKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZEludGVyZXN0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLnN0YXRlQ2hhbmdlZCA9IGZ1bmN0aW9uIChxSWQpIHtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJsb2dpbkNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkbG9jYXRpb25cIiwgbG9naW5Db250cm9sbGVyXSlcclxuICAgICAgICAuY29udHJvbGxlcihcInNpZ251cENvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIHNpZ251cENvbnRyb2xsZXJdKVxyXG4gICAgICAgIC5jb250cm9sbGVyKFwiZWRpdGFibGVDaGVja2JveENvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIGVkaXRhYmxlQ2hlY2tib3hDb250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgaW1hbiBvbiA1LzEyLzE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpe1xyXG5cclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBNYXRjaGVzQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgbWF0Y2hlc1NlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNob3dNYXRjaGVzID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgIHZhciBuYW1lVXNlciA9IFwiTHVuYVwiO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFyck1hdGNoZXNCeVVzZXIgPSBtYXRjaGVzU2VydmljZS5nZXRNYXRjaGVzKG5hbWVVc2VyKTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hYW50YWxNYXRjaGVzID0gYXJyTWF0Y2hlc0J5VXNlci5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYXJyTWF0Y2hlcyA9IGFyck1hdGNoZXNCeVVzZXI7XHJcblxyXG4gICAgICAgICAgICB2YXIgdGV4dCA9IFwiXCI7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpPGFyck1hdGNoZXNCeVVzZXIubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgdGV4dCA9IGFyck1hdGNoZXNCeVVzZXJbaV0uaW50ZXJlc3RzLnRvU3RyaW5nKCkucmVwbGFjZShcIiAsXCIsIFwiIFwiKTtcclxuICAgICAgICAgICAgICAgIGFyck1hdGNoZXNCeVVzZXJbaV0uaW50ZXJlc3RzID0gdGV4dDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwiTWF0Y2hlc0NvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwibWF0Y2hlc1NlcnZpY2VcIiwgTWF0Y2hlc0NvbnRyb2xsZXJdKTtcclxuXHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgaW1hbiBvbiAyMC8xMi8xNS5cclxuICovXHJcblxyXG5cclxuKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIFByb2ZpbGVzQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCBkYlNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgdmFyIGNsaWNrc09uQnRuID0gMDtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNob3dEaXYgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0ge3Nob3dGaWx0ZXI6dHJ1ZX07XHJcbiAgICAgICAgICAgIGNsaWNrc09uQnRuKys7XHJcblxyXG4gICAgICAgICAgICBpZihjbGlja3NPbkJ0biA+IDEpe1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlciA9IHtzaG93RmlsdGVyOmZhbHNlfTtcclxuICAgICAgICAgICAgICAgIGNsaWNrc09uQnRuID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5oaWRlRGl2ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgY2xpY2tzT25CdG4gPSAwO1xyXG4gICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0ge3Nob3dGaWx0ZXI6ZmFsc2V9O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zaG93UHJvZmlsZXMgPSBmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gXCJcIjtcclxuICAgICAgICAgICAgaWYoJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lICE9PSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWUgPSAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGRiU2VydmljZS5nZXRDb2xsZWN0aW9uKCd1c2VycycpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhcnJQcm9maWxlcyA9IHJlc3BvbnNlLnVzZXJsaXN0O1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGFyclByb2ZpbGVzLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICBpZihhcnJQcm9maWxlc1tpXS51c2VybmFtZSA9PT0gdXNlcm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyUHJvZmlsZXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaWkgPSAwOyBpaSA8IGFyclByb2ZpbGVzLmxlbmd0aDsgaWkrKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYXJyUHJvZmlsZXNbaWldLnVzZXJuYW1lID09PSBcImFkbWluXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyUHJvZmlsZXMuc3BsaWNlKGlpLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXJyUHJvZmlsZXMgPSBhcnJQcm9maWxlcztcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc29ydFByb3BlcnR5ID0gXCJ0aXRsZVwiO1xyXG4gICAgICAgICRzY29wZS5maWx0ZXJRdWVyeSA9IFwiXCI7XHJcbiAgICAgICAgJHNjb3BlLmZpbHRlckltYWdlcyA9IGZ1bmN0aW9uKGkpe1xyXG4gICAgICAgICAgICBpZigkc2NvcGUuZmlsdGVyUXVlcnkgPT09IFwiXCIpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8qXHJcbiAgICAgICAgICAgICBlbHNlIGlmKGkudXNlcm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCRzY29wZS5maWx0ZXJRdWVyeS50b0xvY2FsZUxvd2VyQ2FzZSgpKSA+PSAwKXtcclxuICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgKi9cclxuXHJcbiAgICAgICAgICAgIGVsc2UgaWYoaS5zZXggPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGVsc2UgaWYoJHNjb3BlLmZpbHRlclF1ZXJ5LnRvTG93ZXJDYXNlKCkgPT0gaS5zZXgudG9Mb3dlckNhc2UoKSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZWxzZSBpZigkc2NvcGUuZmlsdGVyUXVlcnkudG9Mb3dlckNhc2UoKSA9PT0gXCJub2ZpbHRlclwiKXtcclxuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJRdWVyeSA9IFwiXCI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwiUHJvZmlsZXNDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkcm91dGVQYXJhbXNcIiwgXCJkYlNlcnZpY2VcIiwgUHJvZmlsZXNDb250cm9sbGVyXSk7XHJcblxyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE5pa2l0YSBvbiAyMS8xMi8yMDE1LlxyXG4gKi9cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIC8qdmFyIHNpZ251cENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlKSB7XHJcbiAgICAgICAgJHNjb3BlLmNhdGVnb3JpZXMgPSBbJyddO1xyXG4gICAgICAgICRzY29wZS5uZXdDYXRlZ29yeSA9IFwiXCI7XHJcbiAgICAgICAgJHNjb3BlLnNhdmVDYXRlZ29yeSA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBlZGl0YWJsZUNoZWNrYm94Q29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcclxuICAgICAgICAkc2NvcGUuY2F0ZWdvcnkgPSBcIlwiO1xyXG4gICAgICAgICRzY29wZS5zaG93TGFiZWwgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSB0cnVlO1xyXG4gICAgICAgICRzY29wZS5zYXZlQ2F0ZWdvcnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuY2F0ZWdvcnkpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93TGFiZWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dUZXh0Ym94ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0xhYmVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuZWRpdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dMYWJlbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd1RleHRib3ggPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgfTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJzaWdudXBDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBzaWdudXBDb250cm9sbGVyXSlcclxuICAgICAgICAuY29udHJvbGxlcihcImVkaXRhYmxlQ2hlY2tib3hDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBlZGl0YWJsZUNoZWNrYm94Q29udHJvbGxlcl0pOyovXHJcblxyXG5cclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBNYXJ0aGUgb24gMTYvMTIvMTUuXHJcbiAqL1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIHVzZXJDb250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSwgJHJvb3RTY29wZSwgJGh0dHAsICRsb2NhdGlvbikge1xyXG4gICAgICAgICRodHRwLmdldCgnL3VzZXInKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSBkYXRhO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBkYXRhO1xyXG5cclxuICAgICAgICAgICAgaWYoZGF0YS51c2VybmFtZSA9PSAnYWRtaW4nKXtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hdXRoID0ge2lzQXV0aDogdHJ1ZSwgaXNBZG1pbiA6IHRydWV9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYoZGF0YS51c2VybmFtZSAhPSAnYWRtaW4nICYmIGRhdGEudXNlcm5hbWUgIT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXV0aCA9IHtpc0F1dGg6IHRydWUsIGlzQWRtaW4gOiBmYWxzZX07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZihkYXRhLnVzZXJuYW1lID09PSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmF1dGggPSB7aXNBdXRoOiBmYWxzZSwgaXNBZG1pbiA6IGZhbHNlfTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgLyokc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnL2xvZ291dCcpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGRhdGEucmVkaXJlY3QpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9OyovXHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwidXNlckNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJGxvY2F0aW9uXCIsIHVzZXJDb250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgaW1hbiBvbiAyMC8xMi8xNS5cclxuICovXHJcbihmdW5jdGlvbigpe1xyXG5cclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBVc2Vyc0NvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgZGJTZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5nZXRVc2VycyA9IGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICBkYlNlcnZpY2UuZ2V0Q29sbGVjdGlvbigndXNlcnMnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hcnJVc2VycyA9IHJlc3BvbnNlLnVzZXJsaXN0O1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5nZXREZXRhaWxVc2VyID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgIGRiU2VydmljZS5nZXREZXRhaWxzVXNlcigndXNlcnMnLCAkcm91dGVQYXJhbXMudXNlcm5hbWUpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFyckRldGFpbHMgPSByZXNwb25zZS5hY3Rpdml0eTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmdldFVzZXJCeUlEID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgIGRiU2VydmljZS5nZXRJdGVtKCd1c2VyJykudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJQcm9maWxlID0gcmVzcG9uc2U7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwiVXNlcnNDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRyb3V0ZVBhcmFtc1wiLCBcImRiU2VydmljZVwiLCBVc2Vyc0NvbnRyb2xsZXJdKTtcclxuXHJcbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
